[{"content":"I\u0026rsquo;ve just uploaded to Github a copy of my MSc thesis on Computer Vision and Analysis of the Carotid Artery\nI hadn\u0026rsquo;t looked at my thesis for a while but I was thinking that it might be a nice idea to replicate it as a modern web application with the number crunching handed off to the most appropriate cloud service. Looking at what I did back then, re-implementing the algorithms in a different language and then recreating the 3D graphics will be quite a challenge\u0026hellip;\n","permalink":"http://localhost:1313/posts/my-msc-thesis/","summary":"\u003cp\u003eI\u0026rsquo;ve just uploaded to Github a copy of my MSc thesis on \u003ca href=\"https://github.com/mikebarram/MSc-Thesis\"\u003eComputer Vision and Analysis of the Carotid Artery\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI hadn\u0026rsquo;t looked at my thesis for a while but I was thinking that it might be a nice idea to replicate it as a modern web application with the number crunching handed off to the most appropriate cloud service. Looking at what I did back then, re-implementing the algorithms in a different language and then recreating the 3D graphics will be quite a challenge\u0026hellip;\u003c/p\u003e","title":"My MSc thesis"},{"content":"The Not AI mouse in a maze project was very successful at getting the virtual mouse to navigate a randomly generated maze using a fairly simple set of rules. It could solve about 99% of them. However, there were some maze designs that it got stuck on and others where it was very slow to find the correct path.\nSo, finally it was time to see how well my mouse could do at solving the maze using AI (the NEAT algorithm). A brief description of the code, how it works, and a video of the mouse is on Github\nAt this point I should mention the the amazing world of the micromouse. These are quite different, partly in being physical robots, but mainly that they first get to potter around the maze to build a map of it and then they race to solve the maze against the clock. My mouse isn\u0026rsquo;t able to remember where it has been, it can only leave a trail and then use that trail to see (smell?) that it has been there recently.\nIf you\u0026rsquo;ve been over to Github, you\u0026rsquo;ll see that my AI mouse doesn\u0026rsquo;t seem to make use of the trail and looks to have adopted a wall following strategy:\nOf course it doesn\u0026rsquo;t really have a strategy, it\u0026rsquo;s just managed to get higher scores by consistently steering towards (but not into) a wall on one side. Perhaps, this isn\u0026rsquo;t a surprise as the maze generating algorithm I\u0026rsquo;ve used creates simply connected mazes. These can be thought of as a tree structure, where the exit could be at any node in the tree and where you don\u0026rsquo;t know where the exit node is until you reach it. A backtracking algorithm tries every branch of the tree with as little backtracking as possible nicely described in this Stack Overflow answer and wall following is essentially the same as backtracking.\nWikipedia lists a number of maze solving algorithms. Of these, Trémaux\u0026rsquo;s algorithm looks interesting as a way of solving mazes that contain loops and my mouse, using its scent trail, may be able to work in a similar way. If I want to continue this series of projects, it looks like I should change the maze generating algorithm to one that creates loops. Then, do I go back to the non-AI mouse and implement Trémaux\u0026rsquo;s algorithm, or do I just see if the AI mouse can make use of the scent trail and change how it steers in a way that emulates the behaviour of Trémaux\u0026rsquo;s algorithm?\n","permalink":"http://localhost:1313/posts/ai-mouse-in-a-maze/","summary":"\u003cp\u003eThe \u003ca href=\"not-ai-mouse-in-a-maze\"\u003eNot AI mouse in a maze\u003c/a\u003e project was very successful at getting the virtual mouse to navigate a randomly generated maze using a fairly simple set of rules. It could solve about 99% of them. However, there were some maze designs that it got stuck on and others where it was very slow to find the correct path.\u003c/p\u003e\n\u003cp\u003eSo, finally it was time to see how well my mouse could do at solving the maze using AI (the \u003ca href=\"https://neat-python.readthedocs.io/en/latest/\"\u003eNEAT algorithm\u003c/a\u003e). A brief description of the code, how it works, and a video of the mouse is on \u003ca href=\"https://github.com/mikebarram/AI-Mouse-In-A-Maze/\"\u003eGithub\u003c/a\u003e\u003c/p\u003e","title":"AI mouse in a maze"},{"content":"Building on the Not AI Car project, I started out trying to get the car to drive across a maze. I changed the car to a mouse, as the lines detecting the edge looked like whiskers.\nAs I\u0026rsquo;d done with the track, the first thing to code was an algorithm to generate a random maze each time. The backtracking algorithm was well suited to this application and there were many implementations to choose from (see the code for links), so I just need to make a few modifications.\nOne of my rules for the mouse was that it wasn\u0026rsquo;t allowed to remember where it had already been in the maze, so it couldn\u0026rsquo;t map it out, crossing off dead ends after exploring them. It could however leave a \u0026ldquo;scent\u0026rdquo; trail that would slowly evaporate, so it could tell if it had been somewhere before if it returned soon enough. The measurements at various angles then included the level of scent in each direction, as well as the distances to the maze walls.\nThe algorithm for \u0026ldquo;driving\u0026rdquo; the mouse was then updated to not only keep a reasonable distance from the walls, but to also avoid the scent from a previous visit (at least until the scent had faded enough).\nDealing with dead ends was difficult. They were easy to detect but hard to get out, so I had to write code to detect if the mouse was in a dead end and then use a different method to calculate how to \u0026ldquo;steer\u0026rdquo; out.\nThis was a good project for learning how to deal with performance issues in Python. Most of the arrays used numpy and most of the calculations used numpy functions but performance was still slow. At one point, the mouse was only moving 16 frames/steps per second. I increased this to over 3,000 FPS by:\nUsing profiling to identify the sections of code that most time was being spent on, so I could prioritise the code to be worked on. There are instructions on how to do this at the start of the programme. Using numba to JIT compile certain functions. Not rendering every frame. Pygame\u0026rsquo;s rendering was taking more time than the calculations for each frame so, unless I wanted to play back what happened in navigating a particular maze, there was no need to render every frame. The mouse was very good at getting through the maze, solving it 99% of the time, but there were a few cases that caused problems. So, it was time to see if using AI would help - wait for the next post to find out\u0026hellip;\nYou can find the code and a video of the mouse on Github\n","permalink":"http://localhost:1313/posts/not-ai-mouse-in-a-maze/","summary":"\u003cp\u003eBuilding on the \u003ca href=\"not-ai-car\"\u003eNot AI Car\u003c/a\u003e project, I started out trying to get the car to drive across a maze. I changed the car to a mouse, as the lines detecting the edge looked like whiskers.\u003c/p\u003e\n\u003cp\u003eAs I\u0026rsquo;d done with the track, the first thing to code was an algorithm to generate a random maze each time. The backtracking algorithm was well suited to this application and there were many implementations to choose from (see the code for links), so I just need to make a few modifications.\u003c/p\u003e","title":"Not AI mouse in a maze"},{"content":"I\u0026rsquo;d been looking for a project to work on to learn Python and AI when I came across a video about Neural network racing cars around a track. Initially, I thought creating something like that would be too hard for a first project in Python, so I started work on it.\nMany of the comments on that video asked whether a trained car would do just as well on another track, so I decided to create the track dynamically with an algorithm that would produce a different track each time. Then, I added a car and calculated distances to the edge of the track and thought I should just check that it could drive by providing instructions for steering and acceleration. As I\u0026rsquo;d calculated the distances to the edge of the track, I divided those by the respective angles (positive and negative) and added them up to decide which way to steer and by how much. The distance straight ahead was ignored as it wouldn\u0026rsquo;t affect steering and would resulting in dividing by zero. The acceleration instruction was based on the distance straight ahead. As with a physical car, limits were place on the inputs (rate of change of steering and acceleration/deceleration) and the capabilities of the car (maximum steering angle and speed).\nThis was all displayed using Pygame. The driving that resulted from this was so good that I didn\u0026rsquo;t see much point in using AI to better it.\nYou can find the code and a video of the car driving on Github\n","permalink":"http://localhost:1313/posts/not-ai-car/","summary":"\u003cp\u003eI\u0026rsquo;d been looking for a project to work on to learn Python and AI when I came across a video about \u003ca href=\"https://www.youtube.com/watch?v=wL7tSgUpy8w\"\u003eNeural network racing cars around a track\u003c/a\u003e. Initially, I thought creating something like that would be too hard for a first project in Python, so I started work on it.\u003c/p\u003e\n\u003cp\u003eMany of the comments on that video asked whether a trained car would do just as well on another track, so I decided to create the track dynamically with an algorithm that would produce a different track each time. Then, I added a car and calculated distances to the edge of the track and thought I should just check that it could drive by providing instructions for steering and acceleration. As I\u0026rsquo;d calculated the distances to the edge of the track, I divided those by the respective angles (positive and negative) and added them up to decide which way to steer and by how much. The distance straight ahead was ignored as it wouldn\u0026rsquo;t affect steering and would resulting in dividing by zero. The acceleration instruction was based on the distance straight ahead. As with a physical car, limits were place on the inputs (rate of change of steering and acceleration/deceleration) and the capabilities of the car (maximum steering angle and speed).\u003c/p\u003e","title":"Not AI car"},{"content":"I\u0026rsquo;d previously written blog posts in WordPress but this site uses Markdown instead. The migration process was simply a case of exporting the old posts from WordPress (there\u0026rsquo;s a button in WordPress to do this) and Google \u0026ldquo;WordPress XML export to markdown\u0026rdquo;, which resulted in me using this: https://github.com/lonekorean/wordpress-export-to-markdown\nThere were various warning about deprecated dependencies but, running the script with npx, they weren\u0026rsquo;t installed. The blog posts were converted to markdown in a few seconds and then there was the process of tidying it up, especially embedded images/code and the FrontMatter.\nIt was useful to find someone else who was creating similar content in markdown. This page has examples of pretty much every type of content formatting that I\u0026rsquo;d want to use: https://jesielviana.com/en/blog/best-practices-for-nodejs-api The markdown for this is here: https://raw.githubusercontent.com/jesielviana/jesielviana.com/main/data/blog/best-practices-for-nodejs-api.en.mdx\n","permalink":"http://localhost:1313/posts/migrating-content-to-this-site/","summary":"\u003cp\u003eI\u0026rsquo;d previously written blog posts in WordPress but this site uses Markdown instead. The migration process was simply a case of exporting the old posts from WordPress (there\u0026rsquo;s a button in WordPress to do this) and Google \u0026ldquo;WordPress XML export to markdown\u0026rdquo;, which resulted in me using this:\n\u003ca href=\"https://github.com/lonekorean/wordpress-export-to-markdown\"\u003ehttps://github.com/lonekorean/wordpress-export-to-markdown\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThere were various warning about deprecated dependencies but, running the script with npx, they weren\u0026rsquo;t installed.\nThe blog posts were converted to markdown in a few seconds and then there was the process of tidying it up, especially embedded images/code and the \u003ca href=\"https://github.com/timlrx/tailwind-nextjs-starter-blog#frontmatter\"\u003eFrontMatter\u003c/a\u003e.\u003c/p\u003e","title":"Migrating content to this site"},{"content":"VLC is a handy tool for transcoding video files - in my case, mostly from .MOV to .mp4\nFrom the Media menu, select \u0026ldquo;Convert/Save…\u0026rdquo; Add some files Click \u0026ldquo;Convert/Save\u0026rdquo; button Choose a conversion profile or click the spanner icon to create your own, combining your preferences in video and audio codecs Choose a destination file (unless multiple files are being converted) Click \u0026ldquo;Start\u0026rdquo; Wait a while and hopefully all of your videos will have been transcoded Then you find that you\u0026rsquo;ve lost the \u0026ldquo;Media created\u0026rdquo; meta data for transcoded files has been set to the date/time of the transcoding, not the original date that the video was recorded, and that\u0026rsquo;s the one that you want to sort media by.\nAssuming you\u0026rsquo;ve not deleted the original files, you can get the meta data back in this convoluted way:\nFor all of the old files, write the meta data to a text file and then, for the newly converted files, update the meta data from the text file - as described here:\nhttps://superuser.com/questions/482868/batch-converting-a-video-while-keeping-the-original-time-stamp-creation-date\nThis only allows certain properties to be updated, listed here:\nhttps://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_properties?view=powershell-7.2\nThis doesn\u0026rsquo;t include the \u0026ldquo;Media created\u0026rdquo; property, so instead update CreationTimeUtc\nThen install Exiftool\nAt the command line, you can get a list of the time properties available in a file:\nc:\\\\some folder\\\\\u0026quot;exiftool(-k).exe\u0026quot; -G1 -a -s -time:all d:\\\\Videos\\\\probably\\_kids\\_messing\\_about.mp4\nThen, you can update the meta data for all of the files in a folder like this:\nc:\\\\some folder\\\\\u0026quot;exiftool(-k).exe\u0026quot; -api QuickTimeUTC \u0026quot;-CreateDate\u0026lt;FileCreateDate\u0026quot; d:\\\\videos\\\\mp4\\\\\nThe CreateDate property is updated with the value of the FileCreateProperty\nNext time, I\u0026rsquo;ll use Handbrake, which I believe has an option to preserve meta data when transcoding\u0026hellip;\n","permalink":"http://localhost:1313/posts/transcoding-video-files-and-preserving-media-created-meta-data/","summary":"\u003cp\u003eVLC is a handy tool for transcoding video files - in my case, mostly from .MOV to .mp4\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFrom the Media menu, select \u0026ldquo;Convert/Save…\u0026rdquo;\u003c/li\u003e\n\u003cli\u003eAdd some files\u003c/li\u003e\n\u003cli\u003eClick \u0026ldquo;Convert/Save\u0026rdquo; button\u003c/li\u003e\n\u003cli\u003eChoose a conversion profile or click the spanner icon to create your own, combining your preferences in video and audio codecs\u003c/li\u003e\n\u003cli\u003eChoose a destination file (unless multiple files are being converted)\u003c/li\u003e\n\u003cli\u003eClick \u0026ldquo;Start\u0026rdquo;\u003c/li\u003e\n\u003cli\u003eWait a while and hopefully all of your videos will have been transcoded\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThen you find that you\u0026rsquo;ve lost the \u0026ldquo;Media created\u0026rdquo; meta data for transcoded files has been set to the date/time of the transcoding, not the original date that the video was recorded, and that\u0026rsquo;s the one that you want to sort media by.\u003c/p\u003e","title":"Transcoding video files and preserving \"Media created\" meta data"},{"content":"If you’re going to launch a website out of hours and want an old site that uses Apache to redirect to the new site, you can set a list of rewrite rules to run after a certain time. The trick is to write a condition that makes a rule run until the launch date and that rule skips the new rules. After the launch date, the rule doesn’t run, so the new rules aren’t skipped:\n# Turn on the rewriting engine RewriteEngine On # if the date/time is BEFORE 7:30am on 1st August 2016, the condition is met, so the first rewrite rule executes and skips the next 7 rules. # if the date/time is AFTER 7:30am on 1st August 2016, the condition is not met, so the first rule does not run and therefore the following rules are run (until a match is found, which the last rule is guaranteed to do) # RewriteRules that match a URL are best sorted in reverse order to be sure that the most specific match is found first RewriteCond %{TIME_YEAR}%{TIME_MON}%{TIME_DAY}%{TIME_HOUR}%{TIME_MIN} \u0026lt;201608010730 RewriteRule .* – [S=7] RewriteRule ^section2/subsection2 http://www.newsite.com/section2/subsection2 [NC,L,R=301] RewriteRule ^section2/subsection1 http://www.newsite.com/section2/subsection1 [NC,L,R=301] RewriteRule ^section2 http://www.newsite.com/section2 [NC,L,R=301] RewriteRule ^section1/subsection2 http://www.newsite.com/section1/subsection2 [NC,L,R=301] RewriteRule ^section1/subsection1 http://www.newsite.com/section1/subsection1 [NC,L,R=301] RewriteRule ^section1 http://www.newsite.com/section1 [NC,L,R=301] RewriteRule .* http://www.newsite.com/ [NC,L,R=301] ","permalink":"http://localhost:1313/posts/rewriterules-in-.htaccess-files-that-run-after-a-set-date/time/","summary":"\u003cp\u003eIf you’re going to launch a website out of hours and want an old site that uses Apache to redirect to the new site, you can set a list of rewrite rules to run after a certain time. The trick is to write a condition that makes a rule run until the launch date and that rule skips the new rules. After the launch date, the rule doesn’t run, so the new rules aren’t skipped:\u003c/p\u003e","title":"RewriteRules in .htaccess files that run after a set date/time"},{"content":"I’ve used the JavaScript DataTables plug-in for jQuery a lot. It’s great for easily adding sorting to tables and lots more. It works nicely with Bootstrap too. The clunkiest thing I’ve found is trying to sort columns that contain date / time information. In the past, I used the datetables-date-sort.js plugin, which allows you to specify for each column what the data type is e.g.\n\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; $(document).ready(function () { $(\u0026#34;#myTable\u0026#34;).dataTable({ \u0026#34;aLengthMenu\u0026#34;: \\[\\[10, 25, 50, -1\\], \\[10, 25, 50, \u0026#34;All\u0026#34;\\]\\], \u0026#34;iDisplayLength\u0026#34;: -1, \u0026#34;aoColumnDefs\u0026#34;: \\[ { \u0026#34;bSortable\u0026#34;: false, \u0026#34;aTargets\u0026#34;: \\[0\\] }, { \u0026#34;asSorting\u0026#34;: \\[\u0026#34;asc\u0026#34;, \u0026#34;desc\u0026#34;\\], \u0026#34;aTargets\u0026#34;: \\[1, 2, 3, 4, 5, 6, 7, 8, 9, 10\\] }, { \u0026#34;sType\u0026#34;: \u0026#34;uk-date-time\u0026#34;, \u0026#34;aTargets\u0026#34;: \\[8,10\\] } \\] }); }); \u0026lt;/script\u0026gt; That’s nice and flexible but you have to specify it for each table and, worse still, you have to (remember to) change it each time you add/remove/reorder columns.\nThe new “ultimate” date / time ordering plug-in described in https://www.datatables.net/blog/2014-12-18 gets around that by recognising which columns contain date / time information. The recognition is powered by the moment.js library. The only customisation that you have to do is specify which date / time formats you’ll be using, but you’ll hopefully standardise them into just a handful across the whole site anyway.\nNow I have a script like this, which is written just once and called by every page:\n\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; $(document).ready(function () { $.fn.dataTable.moment(\u0026#39;DD/MM/YYYY\u0026#39;); $.fn.dataTable.moment(\u0026#39;DD/MM/YYYY HH:mm:SS\u0026#39;); $(\u0026#39;.mhsStandardDataTable.mhsNoPaging\u0026#39;).DataTable({ paging: false }); $(\u0026#39;.mhsStandardDataTable:not(.mhsNoPaging)\u0026#39;).dataTable({ paging: true, \u0026#34;aLengthMenu\u0026#34;: \\[\\[10, 25, 50, -1\\], \\[10, 25, 50, \u0026#34;All\u0026#34;\\]\\], \u0026#34;iDisplayLength\u0026#34;: -1 }); }); \u0026lt;/script\u0026gt; To turn any table into a DataTable, I just add the class mhsStandardDataTable. Sometimes I don’t want paging (usually if I’m expecting no more than 20 rows), so I can add the class mhsNoPaging and that removes some of the clutter.\nIn the example above, I’ve restricted myself to just 3 date / time formats. The more verbose formats, with day or month spelt out, are great for making a date really clear and unambiguous but I never use them in tables.\n","permalink":"http://localhost:1313/posts/datatables-automatic-recognition-of-which-table-columns-contain-date/time-information/","summary":"\u003cp\u003eI’ve used the JavaScript \u003ca href=\"https://datatables.net/\"\u003eDataTables\u003c/a\u003e plug-in for jQuery a lot. It’s great for easily adding sorting to tables and lots more. It works nicely with Bootstrap too. The clunkiest thing I’ve found is trying to sort columns that contain date / time information. In the past, I used the datetables-date-sort.js plugin, which allows you to specify for each column what the data type is e.g.\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-html:\" data-lang=\"html:\"\u003e\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt;\n  $(document).ready(function () {\n    $(\u0026#34;#myTable\u0026#34;).dataTable({\n      \u0026#34;aLengthMenu\u0026#34;: \\[\\[10, 25, 50, -1\\], \\[10, 25, 50, \u0026#34;All\u0026#34;\\]\\],\n      \u0026#34;iDisplayLength\u0026#34;: -1,\n      \u0026#34;aoColumnDefs\u0026#34;: \\[\n        { \u0026#34;bSortable\u0026#34;: false, \u0026#34;aTargets\u0026#34;: \\[0\\] },\n        { \u0026#34;asSorting\u0026#34;: \\[\u0026#34;asc\u0026#34;, \u0026#34;desc\u0026#34;\\], \u0026#34;aTargets\u0026#34;: \\[1, 2, 3, 4, 5, 6, 7, 8, 9, 10\\] },\n        { \u0026#34;sType\u0026#34;: \u0026#34;uk-date-time\u0026#34;, \u0026#34;aTargets\u0026#34;: \\[8,10\\] }\n      \\]\n    });\n  });\n\u0026lt;/script\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThat’s nice and flexible but you have to specify it for each table and, worse still, you have to (remember to) change it each time you add/remove/reorder columns.\u003c/p\u003e","title":"DataTables – automatic recognition of which table columns contain date/time information"},{"content":"http://a11ywins.tumblr.com/ lists user contributed sites that are good for accessibility or have made significant improvements. There’s usually a reasonable technical overview of the technologies used. It highlights the efforts that other companies/developers are making, which is useful to spur us on to do better and to help provide justifications to our business owners for why this is important.\nhttp://simplyaccessible.com/article/spangular-accessibility/ a really helpful demo site with explainations on how to make an angularjs application accessible. The code from the demo application would be a good starting point when creating your own angularjs application.\n","permalink":"http://localhost:1313/posts/a-couple-of-articles-on-accessibility/","summary":"\u003cp\u003e\u003ca href=\"http://a11ywins.tumblr.com/\" title=\"Accessibility Wins\"\u003ehttp://a11ywins.tumblr.com/\u003c/a\u003e lists user contributed sites that are good for accessibility or have made significant improvements. There’s usually a reasonable technical overview of the technologies used. It highlights the efforts that other companies/developers are making, which is useful to spur us on to do better and to help provide justifications to our business owners for why this is important.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://simplyaccessible.com/article/spangular-accessibility/\" title=\"Accessible angularjs demo application\"\u003ehttp://simplyaccessible.com/article/spangular-accessibility/\u003c/a\u003e a really helpful demo site with explainations on how to make an angularjs application accessible. The code from the demo application would be a good starting point when creating your own angularjs application.\u003c/p\u003e","title":"A couple of articles on accessibility"},{"content":"I spend a lot (perhaps too much?) time worrying about how applications can become too big and extend beyond their original scope. When asked to create a small application that is either stand-alone or only slightly linked to other systems, it’s too tempting to just add it as an exatra section of an existing application, rather copy/re-create the infrastructure needed for it to be in its own application.\nVisual Studio now provides a lot of the infrastructure, so with a few button clicks you can have an ASP.Net MVC application that’s all plumbed together but often the first thing you do is get rid of the that auto-generated stuff and it doesn’t include all of your own standard customisations. There are a few ways to implement those standard customisations:\nA class library – this is the usual way for code that needs to be included in multiple applications. Version control can be an issue – if there’s a bug in the library or just an update, how do you get the new version to all users? Having your own Nuget repository can help solve this, though developers may only become aware of the update when their working on the application and checking for updates. You may want a mailing list for users of the code too. Standardising look and feel across multiple applications – this shouldn’t be too hard to do with a Nuget that provides _layout.cshtml razor views and standardised CSS. I haven’t tried this yet, so am copying files from application to application, which annoys me every time I do it, but hopefully I’ll have the time to look at this in future.\nAn alternative for the CSS would be to have just one copy on an assets CDN. That would need to be versioned and updated _layouts could point to the latest version. The downside to that would be that sites may end up including multiple standard and local CSS files that then can’t be merged into one to reduce the number of downloads. Sometimes you want to include standard web apis in an application. A common example is an api that provides a list of staff who match a search, which is then called by a search-as-you-type component e.g. Angularjs Typeahead One way to do this is to include those methods in a class library. It was a surprise to fine that you can include a controller in a library and, if that class library is included in another application, then the URLs from the included library just work (unless there’s a controller in the local application with the same URL that overrides it). Because these URLs are local to the application, it is easy to lock them down so that only authenticated users have access. The other, more obvious, way of providing standard web apis is to have a central site that provides them, so there’s no need to copy into each site. That works well for public apis but is more difficult for apis that require authentication. This is where JSON Web Tokens and CORS comes in. ","permalink":"http://localhost:1313/posts/avoiding-monolithic-applications/","summary":"\u003cp\u003eI spend a lot (perhaps too much?) time worrying about how applications can become too big and extend beyond their original scope. When asked to create a small application that is either stand-alone or only slightly linked to other systems, it’s too tempting to just add it as an exatra section of an existing application, rather copy/re-create the infrastructure needed for it to be in its own application.\u003c/p\u003e\n\u003cp\u003eVisual Studio now provides a lot of the infrastructure, so with a few button clicks you can have an ASP.Net MVC application that’s all plumbed together but often the first thing you do is get rid of the that auto-generated stuff and it doesn’t include all of your own standard customisations. There are a few ways to implement those standard customisations:\u003c/p\u003e","title":"Avoiding monolithic applications"},{"content":"In my previous post on avoiding monolithic applications, I mentioned that JSON Web Tokens and CORS could be used to access protected web apis on other sites. Here’s the why and how.\nThe requirement for accessing protected web apis on other sites Ideally (my ideal), each application that is developed would be relatively compact and include only the functionality that is unique to that application. Functionality from other applications would be provided by APIs in those applications and generic functionality (e.g. a staff lookup) would be provided by an application (or multiple) that all other applications can access (almost like a CDN for functionality).\nThe technical difficulties If the API is public and requires no authentication, there are few difficulties and you would typically get the client (JavaScript in the browser) to access the 3rd party API.\nIt’s more difficult if the API requires authentication. The client could sent their username and password with every request with every request and in some situations that works (e.g. XML-RPC requests in WordPress). In the University of Manchester, authentication doesn’t happen in the individual applications (instead we use CAS), so we don’t want passwords to be sent to anything other than the CAS server.\nThere is also the problem that browsers by default block cross-domain resource sharing (e.g. AJAX requests) to protect the user from cross-site scripting attacks.\nThe solutions As you may have guessed from the title of this article, the solutions are JSON Web Tokens (JWT) and Cross-origin resource sharing (CORS)\nJWT is apparently prononced “jot”, possibly because JSON Web Tokens are a JSON version of Simple Web Tokens (SWT), which were pronounced “swot”\nIf a page in Site A wants to access a resource in site B then Site A, which the user has authenticated with, can provide a token to the client that can then be sent in the request to Site B. Site B can then validate that token and then be able to trust that the user is who Site A says they are. To make sure the client can’t pretend to be someone else, the token is encrypted by Site A with a key, so that the client only sees the encrypted token. Site B has the same key, so can decrypt the token and see who the user is. This is best explanation of JWT that I’ve found – I like the hotel room card analogy.\nIf the token contains information such as Staff Id, then JWT will work especially well within an institution, as both the site that creates the token and the site that receives it will have an understanding of the identifier. An extra benefit of encrypted tokens is the low overhead to the receiving service – it doesn’t need to validate the token – no database lookups or checks with the originating server.\nCreating the token was easy. I used Nuget to install the JWT package and created a class for a JWT claim and a function to convert a user into a claim:\nMicrosoft has a Nuget to provide a different library for encoding/decoding JSON Web Tokens. They’re both pretty bad at providing usable examples – the one I used was the one I happened to get to work.\nI can then create a very simple Web API that requires the user to be authenticated (the [Authorize] attribute does this) and returns the token:\nThe JavaScript in my (single page) application gets the token and stores it for use later on:\nThis is the point, later on, where I want to call a method from another application. The token is added to the request header as is the Access-Control-Allow-Origin parameter, which is to keep CORS happy:\nOn the server receiving the request, I have the same class:\nAnd I have some functions to read the token from the request header and convert it to a JwtClaim:\nThen I have a custom attribute filter, which, if applied to a controller class or individual method, will check the token and, optionally, check the properties of the token:\nHere’s that attribute filter being applied to all of the methods in a controller class. In this case I don’t just want a token, I want the user to have a PartyNumber:\nTo solve the problem of cross-domain resource sharing, the application needs to be configured to accept CORS requests. The easiest way is in the web.config but there are fancier ways to set these custom headers, so that they are only sent in response to certain requests or to only allow origins that are in a white-list:\nThe way that CORS works is that:\nThe browser recognises that it is being asked to make a cross-domain request. It doesn’t want to send a potentially sensitive/dangerous request straight off. Instead, it sends a tentative “OPTIONS” request (rather than GET, POST etc.) to the same URL. The server then sends back an empty response saying what information it will accept (the custom headers in the web.config) The browser then sends the request, including the custom headers, especially the token. Some of the articles listed below go into more detail. I’d highly recommend watching the traffic using Fiddler.\nA simple way to get the server to send an empty (except for the headers) response to all OPTIONS requests is to add this to the global.asax:\nProblems / Improvements to be made One thing that you will notice using JWT with CORS is that every single requests requires a “pre-flight” OPTIONS request (you don’t programme these, the browser just makes them). The reason the response to the first options request isn’t cached is because the request contains a custom header – the token. It does mean that you’re doubling the number of requests across the network but, within the University, the options request is only taking 5 milliseconds. This may be more of a concern for mobile users for whom network latency is higher.\nThe code above is pretty rough and ready – you’d certainly want to make it more robust.\nHaving the token expire when the user is still making requests from their SPA is a problem. The responseInterceptor code here shows how you can trap for that and get a fresh token (you’d want to do this whether the request was cross-domain or not).\nUseful articles JWT\nhttp://angular-tips.com/blog/2014/05/json-web-tokens-introduction/ http://jwt.io/ https://auth0.com/blog/2014/01/07/angularjs-authentication-with-cookies-vs-token/ http://engineering.talis.com/articles/elegant-api-auth-angular-js/ CORS\nhttp://www.html5rocks.com/en/tutorials/cors/ http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api https://dlr2008.wordpress.com/2014/01/16/poor-mans-delegation-web-api-version-2-cors-and-system-identitymodel-tokens-jwt-part-2/ https://aspnetwebstack.codeplex.com/discussions/467315 http://stackoverflow.com/questions/12013216/how-to-apply-cors-preflight-cache-to-an-entire-domain ","permalink":"http://localhost:1313/posts/jwt-and-cors-for-cross-site-api-authentication/","summary":"\u003cp\u003eIn my previous post on \u003ca href=\"https://mikebarram.wordpress.com/2015/04/10/avoiding-monolithic-applications/\"\u003eavoiding monolithic applications\u003c/a\u003e, I mentioned that JSON Web Tokens and CORS could be used to access protected web apis on other sites. Here’s the why and how.\u003c/p\u003e\n\u003ch2 id=\"the-requirement-foraccessing-protected-web-apis-on-other-sites\"\u003eThe requirement for accessing protected web apis on other sites\u003c/h2\u003e\n\u003cp\u003eIdeally (my ideal), each application that is developed would be relatively compact and include only the functionality that is unique to that application. Functionality from other applications would be provided by APIs in those applications and generic functionality (e.g. a staff lookup) would be provided by an application (or multiple) that all other applications can access (almost like  a CDN for functionality).\u003c/p\u003e","title":"JWT and CORS for cross-site API authentication"},{"content":"The rule for whether the HTTP referrer (incorrectly spelt in the original spec, so forever incorrectly spelt in headers) is sent along with a request has always been a bit odd. If the referring site uses https, the referrer isn’t sent, unless the site linked too also uses https. It isn’t sent because the originating URL may contain sensitive information but the browser happily sends the sensitive URL to any other site if it uses https.\nNow, there is a meta tag you can use that tells browsers whether or not to send the referrer. The options are Never, Origin (only the domain name is sent), Default (same as without the tag), Always. If you’re not worried about other sites knowing your site exists and links to their site, \u0026lt;meta name=\u0026quot;referrer\u0026quot; content=\u0026quot;origin\u0026quot;\u0026gt; seems the best option for sites using htttps.\nThis has been implemented in Chrome, Safari and recently in Firefox\nThere’s a better description of this here:\nhttp://smerity.com/articles/2013/where_did_all_the_http_referrers_go.html\nIt looks like the options are being changed:\nhttp://w3c.github.io/webappsec/specs/referrer-policy/#referrer-policy-delivery-meta\nThey’re now:\nno-referrer origin no-referrer-when-downgrade origin-when-crossorigin unsafe-url origin-when-crossorigin sounds like a better option for most intranets, as one page in the intranet can get the full referrer when linked to from another, but external sites (whether using https or not) will just get the domain name. At the moment (27th March 2015), I think Firefox supports these latest values but Chrome doesn’t, so it’s better to use origin.\nAs well as a page-wide meta tag, you can also set a referrer attribute on the \u0026lt;a\u0026gt;, \u0026lt;area\u0026gt;, \u0026lt;img\u0026gt; or \u0026lt;iframe\u0026gt; elements:\nhttp://w3c.github.io/webappsec/specs/referrer-policy/#referrer-policy-delivery-referrer-attribute\n","permalink":"http://localhost:1313/posts/http-referer-/-referrer-and-https/","summary":"\u003cp\u003eThe rule for whether the HTTP referrer (incorrectly spelt in the original spec, so forever incorrectly spelt in headers) is sent along with a request has always been a bit odd. If the referring site uses https, the referrer isn’t sent, unless the site linked too also uses https. It isn’t sent because the originating URL may contain sensitive information but the browser happily sends the sensitive URL to any other site if it uses https.\u003c/p\u003e","title":"HTTP Referer / Referrer and HTTPS"},{"content":"In Managing Errors in MVC I got close to having record level error handling working as I wanted but I had to create a view for each error when usually the error is a single line of text that could be stored in a config file.\nBased on my original code and http://weblogs.asp.net/gunnarpeipman/asp-net-mvc-3-creating-httpstatuscoderesult-with-view-based-body\nHelpers\\ExceptionHelper.cs\nusing System; using System.Linq.Expressions; using System.Net; using System.Web; using System.Web.Mvc; using System.Web.Routing; using System.Collections; using System.Collections.Generic; namespace MyProject { public class ExceptionHelper : ViewResult { private ExceptionName \\_exceptionName; private HttpStatusCode? \\_statusCode; private bool? \\_logException; public ExceptionHelper(ExceptionName exceptionName, HttpStatusCode? statusCode = null, bool? logException = null) { \\_exceptionName = exceptionName; \\_statusCode = statusCode; \\_logException = logException; } public override void ExecuteResult(ControllerContext context) { HttpStatusCode returnStatusCode = HttpStatusCode.BadRequest; bool returnLogException = true; string ExceptionDescription = string.Empty; string sViewName = \u0026#34;Exceptions/\\_GenericException\u0026#34;; var httpContext = context.HttpContext; var response = httpContext.Response; // get the defaults for this exception ExceptionActions theseExceptionActions; if (ExceptionDefaults.TryGetValue(\\_exceptionName, out theseExceptionActions)) { if (theseExceptionActions.UseCustomView) { sViewName = \u0026#34;Exceptions/\u0026#34; + \\_exceptionName.ToString(); } ExceptionDescription = theseExceptionActions.ExceptionDescription; if (null == \\_statusCode) { returnStatusCode = theseExceptionActions.StatusCode; } else { returnStatusCode = (HttpStatusCode)\\_statusCode; } if (null == \\_logException) { returnLogException = theseExceptionActions.LogException; } else { returnLogException = (bool)\\_logException; } } response.StatusCode = (int)returnStatusCode; response.StatusDescription = ExceptionDescription; ViewBag.ExceptionDescription = ExceptionDescription; ViewName = sViewName; if (returnLogException) { // log the exception Elmah.ErrorSignal.FromCurrentContext().Raise(new Exception(\\_exceptionName.ToString())); } base.ExecuteResult(context); } public enum ExceptionName { DataNotValid, NoPermissionToManageThisPerson, NoPermissionToManageThisProject, RecordNotFound, RecordNotSpecified }; /// \u0026lt;summary\u0026gt; /// Most exceptions will have UseCustomView=false, so the ExceptionDescription will be used for the error message that is displayed in the \\_GenericException view /// If a custom view is required, it will have the name of the exception /// \u0026lt;/summary\u0026gt; public struct ExceptionActions { public bool UseCustomView; public HttpStatusCode StatusCode; public bool LogException; public string ExceptionDescription; } public static Dictionary\u0026lt;ExceptionName, ExceptionActions\\\u0026gt; ExceptionDefaults = new Dictionary\u0026lt;ExceptionName, ExceptionActions\\\u0026gt;() { {ExceptionName.DataNotValid, new ExceptionActions {UseCustomView = false, StatusCode = HttpStatusCode.BadRequest, LogException = true, ExceptionDescription = \u0026#34;Data provided was not valid\u0026#34;}}, {ExceptionName.NoPermissionToManageThisPerson, new ExceptionActions {UseCustomView = false, StatusCode = HttpStatusCode.Forbidden, LogException = false, ExceptionDescription = \u0026#34;You don\u0026#39;t have permission to manage this person\u0026#34;}}, {ExceptionName.NoPermissionToManageThisProject, new ExceptionActions {UseCustomView = false, StatusCode = HttpStatusCode.Forbidden, LogException = false, ExceptionDescription = \u0026#34;You don\u0026#39;t have permission to manage this project\u0026#34;}}, {ExceptionName.RecordNotFound, new ExceptionActions {UseCustomView = false, StatusCode = HttpStatusCode.NotFound, LogException = false, ExceptionDescription = \u0026#34;Record was not found\u0026#34;}}, {ExceptionName.RecordNotSpecified, new ExceptionActions {UseCustomView = false, StatusCode = HttpStatusCode.BadRequest, LogException = false, ExceptionDescription = \u0026#34;Record not specified - one or more identifiers were missing\u0026#34;}}, }; } } Views\\Shared\\Exceptions\\_GenericException.cshtml\n@{ ViewBag.Title = ViewBag.ExceptionDescription; Layout = \u0026#34;~/Views/Shared/\\_Layout.cshtml\u0026#34;; } \u0026lt;div class\\=\u0026#34;alert alert-warning\u0026#34;\\\u0026gt; \u0026lt;h2\\\u0026gt;Error\u0026lt;/h2\\\u0026gt; \u0026lt;p\\\u0026gt;@ViewBag.ExceptionDescription\u0026lt;/p\\\u0026gt; \u0026lt;/div\\\u0026gt; **In a controller** if (!model.CanUserEdit()) return new ExceptionHelper(ExceptionHelper.ExceptionName.NoPermissionToManageThisProject); This will return the _GenericException.cshtml view with the message “You don’t have permission to manage this project” and the status code Forbidden. In this case, Elmah won’t log the error but you could easily log it with:\nif (!model.CanUserEdit()) return new ExceptionHelper(ExceptionHelper.ExceptionName.NoPermissionToManageThisProject, true); ","permalink":"http://localhost:1313/posts/updated-error-handling/","summary":"\u003cp\u003eIn \u003ca href=\"/blog/2014/managing-errors-in-mvc/\"\u003eManaging Errors in MVC\u003c/a\u003e I got close to having record level error handling working as I wanted but I had to create a view for each error when usually the error is a single line of text that could be stored in a config file.\u003c/p\u003e\n\u003cp\u003eBased on my original code and http://weblogs.asp.net/gunnarpeipman/asp-net-mvc-3-creating-httpstatuscoderesult-with-view-based-body\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eHelpers\\ExceptionHelper.cs\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Linq.Expressions;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Net;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Web;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Web.Mvc;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Web.Routing;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Collections;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eusing\u003c/span\u003e System.Collections.Generic;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003enamespace\u003c/span\u003e MyProject\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eclass\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eExceptionHelper\u003c/span\u003e : ViewResult\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eprivate\u003c/span\u003e ExceptionName \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_exceptionName;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eprivate\u003c/span\u003e HttpStatusCode? \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_statusCode;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003eprivate\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ebool?\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_logException;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e ExceptionHelper(ExceptionName exceptionName, HttpStatusCode? statusCode = \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003ebool?\u003c/span\u003e logException = \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_exceptionName = exceptionName;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_statusCode = statusCode;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_logException = logException;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eoverride\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e ExecuteResult(ControllerContext context)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            HttpStatusCode returnStatusCode = HttpStatusCode.BadRequest;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e returnLogException = \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e ExceptionDescription = \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e.Empty;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e sViewName = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Exceptions/\\_GenericException\u0026#34;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e httpContext = context.HttpContext;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e response = httpContext.Response;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#75715e\"\u003e// get the defaults for this exception\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ExceptionActions theseExceptionActions;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (ExceptionDefaults.TryGetValue(\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_exceptionName, \u003cspan style=\"color:#66d9ef\"\u003eout\u003c/span\u003e theseExceptionActions))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (theseExceptionActions.UseCustomView)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    sViewName = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Exceptions/\u0026#34;\u003c/span\u003e + \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_exceptionName.ToString();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                ExceptionDescription = theseExceptionActions.ExceptionDescription;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e == \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_statusCode)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    returnStatusCode = theseExceptionActions.StatusCode;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    returnStatusCode = (HttpStatusCode)\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_statusCode;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e == \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_logException)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    returnLogException = theseExceptionActions.LogException;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                    returnLogException = (\u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e)\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_logException;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response.StatusCode = (\u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e)returnStatusCode;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            response.StatusDescription = ExceptionDescription;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ViewBag.ExceptionDescription = ExceptionDescription;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            ViewName = sViewName;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (returnLogException)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                \u003cspan style=\"color:#75715e\"\u003e// log the exception\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                Elmah.ErrorSignal.FromCurrentContext().Raise(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Exception(\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_exceptionName.ToString()));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003ebase\u003c/span\u003e.ExecuteResult(context);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eenum\u003c/span\u003e ExceptionName\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            DataNotValid,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            NoPermissionToManageThisPerson,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            NoPermissionToManageThisProject,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            RecordNotFound,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            RecordNotSpecified\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e/// \u0026lt;summary\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e/// Most exceptions will have UseCustomView=false, so the ExceptionDescription will be used for the error message that is displayed in the \\_GenericException view\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e/// If a custom view is required, it will have the name of the exception\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e/// \u0026lt;/summary\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eExceptionActions\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e UseCustomView;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e HttpStatusCode StatusCode;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003ebool\u003c/span\u003e LogException;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e ExceptionDescription;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estatic\u003c/span\u003e Dictionary\u0026lt;ExceptionName, ExceptionActions\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e\u0026gt; ExceptionDefaults = \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Dictionary\u0026lt;ExceptionName, ExceptionActions\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e\u0026gt;()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {ExceptionName.DataNotValid, \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e ExceptionActions {UseCustomView = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, StatusCode = HttpStatusCode.BadRequest, LogException = \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e, ExceptionDescription = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Data provided was not valid\u0026#34;\u003c/span\u003e}},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {ExceptionName.NoPermissionToManageThisPerson, \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e ExceptionActions {UseCustomView = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, StatusCode = HttpStatusCode.Forbidden, LogException = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, ExceptionDescription = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;You don\u0026#39;t have permission to manage this person\u0026#34;\u003c/span\u003e}},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {ExceptionName.NoPermissionToManageThisProject, \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e ExceptionActions {UseCustomView = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, StatusCode = HttpStatusCode.Forbidden, LogException = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, ExceptionDescription = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;You don\u0026#39;t have permission to manage this project\u0026#34;\u003c/span\u003e}},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {ExceptionName.RecordNotFound, \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e ExceptionActions {UseCustomView = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, StatusCode = HttpStatusCode.NotFound, LogException = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, ExceptionDescription = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Record was not found\u0026#34;\u003c/span\u003e}},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            {ExceptionName.RecordNotSpecified, \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e ExceptionActions {UseCustomView = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, StatusCode = HttpStatusCode.BadRequest, LogException = \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e, ExceptionDescription = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Record not specified - one or more identifiers were missing\u0026#34;\u003c/span\u003e}},\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eViews\\Shared\\Exceptions\\_GenericException.cshtml\u003c/strong\u003e\u003c/p\u003e","title":"Updated error handling"},{"content":"Concern over whether my modal dialogs are accessible led on this series of articles:\nA great starting point if you don’t know why your sites should be accessible:\nhttp://alistapart.com/article/reframing-accessibility-for-the-web\nhttps://www.marcozehe.de/2015/02/05/advanced-aria-tip-2-accessible-modal-dialogs/ http://accessibility.oit.ncsu.edu/training/aria/modal-window/version-2/ http://www.paciellogroup.com/blog/2014/09/web-components-punch-list/ The very dry formal stuff\nhttp://www.w3.org/TR/wai-aria/\nSome examples\nhttp://www.w3.org/WAI/PF/aria-practices/#aria_ex\nThese link to real examples e.g. http://www.oaa-accessibility.org/examplep/grid1/\nhttp://www.paciellogroup.com/resources/\nhttp://www.paciellogroup.com/blog/2015/01/the-browser-accessibility-tree/\nhttp://www.paciellogroup.com/blog/2014/12/using-aria-describedby-to-provide-helpful-form-hints/\nhttp://www.paciellogroup.com/blog/2014/08/using-the-tabindex-attribute/\nScreen readers\nhttp://webaim.org/projects/screenreadersurvey5/\nFree screen reader http://www.nvaccess.org/ (donate if you can) You can change the voice from the notifications area and Preferences \u0026gt; Synthesizer\n","permalink":"http://localhost:1313/posts/catching-up-on-accessibility-techniques/","summary":"\u003cp\u003eConcern over whether my modal dialogs are accessible led on this series of articles:\u003c/p\u003e\n\u003cp\u003eA great starting point if you don’t know why your sites should be accessible:\u003cbr\u003e\n\u003ca href=\"http://alistapart.com/article/reframing-accessibility-for-the-web\"\u003ehttp://alistapart.com/article/reframing-accessibility-for-the-web\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.marcozehe.de/2015/02/05/advanced-aria-tip-2-accessible-modal-dialogs/\"\u003ehttps://www.marcozehe.de/2015/02/05/advanced-aria-tip-2-accessible-modal-dialogs/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://accessibility.oit.ncsu.edu/training/aria/modal-window/version-2/\"\u003ehttp://accessibility.oit.ncsu.edu/training/aria/modal-window/version-2/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.paciellogroup.com/blog/2014/09/web-components-punch-list/\"\u003ehttp://www.paciellogroup.com/blog/2014/09/web-components-punch-list/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe very dry formal stuff\u003cbr\u003e\n\u003ca href=\"http://www.w3.org/TR/wai-aria/\"\u003ehttp://www.w3.org/TR/wai-aria/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eSome examples\u003cbr\u003e\n\u003ca href=\"http://www.w3.org/WAI/PF/aria-practices/#aria_ex\"\u003ehttp://www.w3.org/WAI/PF/aria-practices/#aria_ex\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThese link to real examples e.g. \u003ca href=\"http://www.oaa-accessibility.org/examplep/grid1/\"\u003ehttp://www.oaa-accessibility.org/examplep/grid1/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.paciellogroup.com/resources/\"\u003ehttp://www.paciellogroup.com/resources/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.paciellogroup.com/blog/2015/01/the-browser-accessibility-tree/\"\u003ehttp://www.paciellogroup.com/blog/2015/01/the-browser-accessibility-tree/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.paciellogroup.com/blog/2014/12/using-aria-describedby-to-provide-helpful-form-hints/\"\u003ehttp://www.paciellogroup.com/blog/2014/12/using-aria-describedby-to-provide-helpful-form-hints/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.paciellogroup.com/blog/2014/08/using-the-tabindex-attribute/\"\u003ehttp://www.paciellogroup.com/blog/2014/08/using-the-tabindex-attribute/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e \u003cstrong\u003eScreen readers\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://webaim.org/projects/screenreadersurvey5/\"\u003ehttp://webaim.org/projects/screenreadersurvey5/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFree screen reader \u003ca href=\"http://www.nvaccess.org/\"\u003ehttp://www.nvaccess.org/\u003c/a\u003e (donate if you can) You can change the voice from the notifications area and Preferences \u0026gt; Synthesizer\u003c/p\u003e","title":"Catching up on accessibility techniques"},{"content":"If your WebApi controller is checking that the user has permission to view a particular record and it turns out that they don’t then you will want to return a status of Forbidden, rather than Unauthorized as discussed here: http://stackoverflow.com/questions/238437/why-does-authorizeattribute-redirect-to-the-login-page-for-authentication-and-au/5844884#5844884\n(You might also want to override the AuthorizeAttribute class as described there)\nWebApi2 controllers now return IHttpActionResult rather than HttpResponseMessage (see http://stackoverflow.com/questions/21758615/why-should-i-use-ihttpactionresult-instead-of-httpresponsemessage). It’s easy to return a result from the System.Web.Http.Results Namespace e.g. return Unauthorized();\nBut the namespace doesn’t contain Forbidden, so instead use:\nreturn ResponseMessage(new HttpResponseMessage(HttpStatusCode.Forbidden)); Or, more simply:\nreturn StatusCode(HttpStatusCode.NotFound); ","permalink":"http://localhost:1313/posts/getting-a-webapi2-controller-to-return-httpstatuscode.forbidden/","summary":"\u003cp\u003eIf your WebApi controller is checking that the user has permission to view a particular record and it turns out that they don’t then you will want to return a status of Forbidden, rather than Unauthorized as discussed here:\n\u003ca href=\"http://stackoverflow.com/questions/238437/why-does-authorizeattribute-redirect-to-the-login-page-for-authentication-and-au/5844884#5844884\"\u003ehttp://stackoverflow.com/questions/238437/why-does-authorizeattribute-redirect-to-the-login-page-for-authentication-and-au/5844884#5844884\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e(You might also want to override the AuthorizeAttribute class as described there)\u003c/p\u003e\n\u003cp\u003eWebApi2 controllers now return IHttpActionResult rather than HttpResponseMessage (see http://stackoverflow.com/questions/21758615/why-should-i-use-ihttpactionresult-instead-of-httpresponsemessage). It’s easy to return a result from the System.Web.Http.Results Namespace e.g. return Unauthorized();\u003cbr\u003e\nBut the namespace doesn’t contain Forbidden, so instead use:\u003c/p\u003e","title":"Getting a WebApi2 controller to return HttpStatusCode.Forbidden"},{"content":"Error logging Elmah seems to be the most popular tool for error logging but the Elmah website doesn’t have much up to date information on how to get started. To get Elmah installed, secured and logging to somewhere more permanent than keeping the log in-memory, follow this guide: http://www.erikojebo.se/Code/Details/607\nError handling Elmah just logs error, it doesn’t help the user. So you also need to handle the errors, which this article covers nicely:\nhttps://www.simple-talk.com/dotnet/asp.net/handling-errors-effectively-in-asp.net-mvc/\nIn the web.config:\n\u0026lt;httpErrors errorMode\\=\u0026#34;Custom\u0026#34; existingResponse\\=\u0026#34;Replace\u0026#34;\\\u0026gt; \u0026lt;remove statusCode\\=\u0026#34;403\u0026#34; /\u0026gt; \u0026lt;error statusCode\\=\u0026#34;403\u0026#34; path\\=\u0026#34;/WorkloadPlanner/Error/403\u0026#34; responseMode\\=\u0026#34;ExecuteURL\u0026#34; /\u0026gt; \u0026lt;remove statusCode\\=\u0026#34;404\u0026#34; /\u0026gt; \u0026lt;error statusCode\\=\u0026#34;404\u0026#34; path\\=\u0026#34;/WorkloadPlanner/Error/404\u0026#34; responseMode\\=\u0026#34;ExecuteURL\u0026#34; /\u0026gt; \u0026lt;remove statusCode\\=\u0026#34;500\u0026#34; /\u0026gt; \u0026lt;error statusCode\\=\u0026#34;500\u0026#34; path\\=\u0026#34;/WorkloadPlanner/Error/500\u0026#34; responseMode\\=\u0026#34;ExecuteURL\u0026#34; /\u0026gt; \u0026lt;/httpErrors\\\u0026gt; Then an \u0026ldquo;error\u0026rdquo; controller:\n\\[RoutePrefix(\u0026#34;error\u0026#34;)\\] \\[Route(\u0026#34;{action=index}\u0026#34;)\\] public class ErrorController : Controller { // GET: Error \\[Route(\u0026#34;{StatusCode}\u0026#34;)\\] public ActionResult Index(int? StatusCode) { if (null == StatusCode) { return View(\u0026#34;Exceptions/Unknown\u0026#34;); } Response.StatusCode = (int)StatusCode; return View(\u0026#34;Exceptions/\u0026#34; + StatusCode.ToString()); } } Then, for each exception, a very simple view with the appropriate error message.\nThe advantage of this is that it allows for code in the controller e.g. switch(StatusCode) and more verbose error messages, and even pictures, in the views.\nHandling requests where the user is allowed to access the “page” (i.e. method in the controller) but not for the specified parameter(s). In other words, the user doesn’t have permission to view/edit/delete a record\nSometimes you want the user to be able to try and do something they shouldn’t, so that they can see that it’s possible and that they just need to ask for access. In those cases, I’ll do a permission check and if they haven’t got permission, the controller will return a custom view that explains the problem and how to request access. At the same time, without throwing an error, I’d like to return the HTTP status code 403 Forbidden. This explains why 403 rather than 401 http://stackoverflow.com/questions/3297048/403-forbidden-vs-401-unauthorized-http-responses.\nOther times, the user really should have found their way to the URL, so I want to log the log the Error to Elmah and then return a view and 403 status code as above.\nAs with the generic errors above, for each message that I want to return to the user, I’ve created a view.\nThen I’ve created a helper class that gets the name of the view and sets the status code and whether to log errors:\npublic static class ExceptionHelper { public enum ExceptionName { NotOwnWorkload, NotReportViewerForGroup, WorkloadNotRecorded }; /// \u0026lt;summary\u0026gt; /// Gets the name of the view related to the exception name entered. /// Sets the StatusCode of the response as requested or to the default for the specified exception. /// Logs the exception if specified or if that\u0026#39;s the default behavious for the exception. /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;ExceptionName\u0026#34;\\\u0026gt;Name of the exception.\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;StatusCode\u0026#34;\\\u0026gt;The status code.\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;LogException\u0026#34;\\\u0026gt;The log exception.\u0026lt;/param\u0026gt; /// \u0026lt;returns\u0026gt;\u0026lt;/returns\u0026gt; public static string GetViewName(ExceptionName ExceptionName, HttpStatusCode? StatusCode = null, bool? LogException = null) { // set a default return status code HttpStatusCode returnStatusCode = HttpStatusCode.BadRequest; if (null == StatusCode) { // use the default for he ExceptionName to decide switch (ExceptionName) { case ExceptionName.NotOwnWorkload: returnStatusCode = HttpStatusCode.Forbidden; break; case ExceptionName.NotReportViewerForGroup: returnStatusCode = HttpStatusCode.Forbidden; break; case ExceptionName.WorkloadNotRecorded: returnStatusCode = HttpStatusCode.OK; break; default: returnStatusCode = HttpStatusCode.BadRequest; break; } } else { // StatusCode not null so convert to Boolean returnStatusCode = (HttpStatusCode)StatusCode; } HttpContext.Current.Response.StatusCode = (int)returnStatusCode; // set a default for logging exceptions bool bLogException = true; if (null == LogException) { // use the default for he ExceptionName to decide switch (ExceptionName) { case ExceptionName.NotOwnWorkload: bLogException = true; break; case ExceptionName.NotReportViewerForGroup: bLogException = false; break; case ExceptionName.WorkloadNotRecorded: bLogException = false; break; default: bLogException = true; break; } } else { // LogException not null so convert to Boolean bLogException = Convert.ToBoolean(LogException); } if (bLogException) { Elmah.ErrorSignal.FromCurrentContext().Raise(new Exception(ExceptionName.ToString())); } return \u0026#34;Exceptions/\u0026#34; + ExceptionName.ToString(); } } Then, in this case, if workload isn\u0026rsquo;t to be recorded, the method can return a view:\nreturn View(ExceptionHelper.GetViewName(ExceptionHelper.ExceptionName.WorkloadNotRecorded));\nNote: there is now an updated version of this code in Updated error handling\n","permalink":"http://localhost:1313/posts/managing-errors-in-mvc/","summary":"\u003ch2 id=\"error-logging\"\u003eError logging\u003c/h2\u003e\n\u003cp\u003eElmah seems to be the most popular tool for error logging but the Elmah website doesn’t have much up to date information on how to get started. To get Elmah installed, secured and logging to somewhere more permanent than keeping the log in-memory, follow this guide: http://www.erikojebo.se/Code/Details/607\u003c/p\u003e\n\u003ch2 id=\"error-handling\"\u003eError handling\u003c/h2\u003e\n\u003cp\u003eElmah just logs error, it doesn’t help the user. So you also need to handle the errors, which this article covers nicely:\u003cbr\u003e\n\u003ca href=\"https://www.simple-talk.com/dotnet/asp.net/handling-errors-effectively-in-asp.net-mvc/\"\u003ehttps://www.simple-talk.com/dotnet/asp.net/handling-errors-effectively-in-asp.net-mvc/\u003c/a\u003e\u003c/p\u003e","title":"Managing errors in MVC"},{"content":"In your MVC site, you might want this URL to purchase 2.5 kilos of cheese for you\nhttps://www.mysite.com/cheese/purchase/2.5\nUnfortunately it won’t be recognised as a route to the purchase method within the cheese controller. The good news is that this will work:\nhttps://www.mysite.com/cheese/purchase/2.5/ Note the extra slash at the end\nThis is an explanation why:\nhttp://stackoverflow.com/questions/21387974/why-is-my-web-api-method-with-double-args-not-getting-called\nIt’s fairly unusual to have a valid reason for a URL like this. If you want to pass a parameter that’s a float, it’s more likely that you would want to post the data.\n","permalink":"http://localhost:1313/posts/asp.net-mvc-and-urls-ending-in-a-decimal-or-float/","summary":"\u003cp\u003eIn your MVC site, you might want this URL to purchase 2.5 kilos of cheese for you\u003cbr\u003e\n\u003ca href=\"https://www.mysite.com/cheese/purchase/2.5\"\u003ehttps://www.mysite.com/cheese/purchase/2.5\u003c/a\u003e\u003cbr\u003e\nUnfortunately it won’t be recognised as a route to the purchase method within the cheese controller. The good news is that this will work:\u003cbr\u003e\n\u003ca href=\"https://www.mysite.com/cheese/purchase/2.5/\"\u003ehttps://www.mysite.com/cheese/purchase/2.5/\u003c/a\u003e Note the extra slash at the end\u003c/p\u003e\n\u003cp\u003eThis is an explanation why:\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/21387974/why-is-my-web-api-method-with-double-args-not-getting-called\"\u003ehttp://stackoverflow.com/questions/21387974/why-is-my-web-api-method-with-double-args-not-getting-called\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIt’s fairly unusual to have a valid reason for a URL like this. If you want to pass a parameter that’s a float, it’s more likely that you would want to post the data.\u003c/p\u003e","title":"ASP.Net MVC and URLs ending in a decimal or float"},{"content":"In this case the value selector is used like this:\n$(“.pPlacement select option\\[value=\u0026#39;” + PlacementId + “‘\\]”).attr(‘selected’, true); When PlacementId changes from a number to text and that text then contains an apostrophe, then it breaks!\nTo explain the code above, thee’s a dropdown list of placements and from somewhere we have the value of the one that we want to have as the selected option. The selector picks the option with the value equal to PlacementId and selects it.\nThe problem with this is similar to a SQL injection attack – we’re executing code that contains a variable. To get around this, we only use the variable as a parameter, like this:\n$(“.pPlacement select option”).each(function() { if(this.value == PlacementId) $(this).attr(‘selected’, true); }); ","permalink":"http://localhost:1313/posts/what-could-go-wrong-with-a-simple-jquery-value-selector/","summary":"\u003cp\u003eIn this case the value selector is used like this:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-js:\" data-lang=\"js:\"\u003e$(“.pPlacement select option\\[value=\u0026#39;” + PlacementId + “‘\\]”).attr(‘selected’, true);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWhen PlacementId changes from a number to text and that text then contains an apostrophe, then it breaks!\u003c/p\u003e\n\u003cp\u003eTo explain the code above, thee’s a dropdown list of placements and from somewhere we have the value of the one that we want to have as the selected option. The selector picks the option with the value equal to PlacementId and selects it.\u003c/p\u003e","title":"What could go wrong with a simple jQuery value selector?"},{"content":"If your page contains an iframe and you need to dynamically add a stylesheet, you can do it like this:\nvar $head = $(“#myIframe”).contents().find(“head”); $head.append($(“\u0026lt;link/\u0026gt;”, { rel: “stylesheet”, href: window.location.protocol + “//” + window.location.host + “/mystyles/mystylesheet.css”, type: “text/css” })); Even if the domain for the stylesheet is the same as the parent page and the iframe, you still need to include the host address of the stylesheet (the protocol and host bit) or IE will ignore it.\nfrom\nhttp://stackoverflow.com/questions/6960406/add-css-to-iframe\nand http://css-tricks.com/snippets/javascript/get-url-and-url-parts-in-javascript/\n","permalink":"http://localhost:1313/posts/adding-a-stylesheet-to-an-iframe/","summary":"\u003cp\u003eIf your page contains an iframe and you need to dynamically add a stylesheet, you can do it like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e$head\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e$\u003c/span\u003e(\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e“#\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emyIframe\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e”\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003econtents\u003c/span\u003e().\u003cspan style=\"color:#a6e22e\"\u003efind\u003c/span\u003e(\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e“\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ehead\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e”\u003c/span\u003e);  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e$head\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eappend\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e$\u003c/span\u003e(\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e“\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003elink\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e”\u003c/span\u003e, { \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e“\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003estylesheet\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e”\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e window.\u003cspan style=\"color:#a6e22e\"\u003elocation\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eprotocol\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e“\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e//” + window.location.host + “/mystyles/mystylesheet.css”, type: “text/css” }));\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEven if the domain for the stylesheet is the same as the parent page and the iframe, you still need to include the host address of the stylesheet (the protocol and host bit) or IE will ignore it.\u003c/p\u003e\n\u003cp\u003efrom\u003cbr\u003e\n\u003ca href=\"http://stackoverflow.com/questions/6960406/add-css-to-iframe\"\u003ehttp://stackoverflow.com/questions/6960406/add-css-to-iframe\u003c/a\u003e\u003cbr\u003e\nand\n\u003ca href=\"http://css-tricks.com/snippets/javascript/get-url-and-url-parts-in-javascript/\"\u003ehttp://css-tricks.com/snippets/javascript/get-url-and-url-parts-in-javascript/\u003c/a\u003e\u003c/p\u003e","title":"Adding a stylesheet to an iframe"},{"content":"EntityFramework’s own tool to generate a model from a database is slow and buggy. It’s particularly a problem if you update your database (change table names, field names etc.).\nEntityFramework Reverse POCO Generator is a great, lightweight replacement – it’s fast, configurable and just works. Also, the entities created can be the same as those created by the built in tool, so it is possible to switch to it part way through developing a project.\nThe only problem I’ve encountered is where I need to create an entity (read-only) from a view. In this case a view on a table in a different database. Because it can’t read the schema of the underlying table, it can get data types and nullability wrong. To help Reverse POCO Generator get it right, you can use CAST to show that the field really is whatever data type it is and you can also use ISNULL([non-null-field],0) to show that the field will never be null. A problem with using ISNULL is that Reverse POCO Generator will use non-null fields to create a primary key, so you may want to do the opposite and use NULLIF([non-null-non-key-field],-1). This is all better explained here:\nhttp://girlfromoutofthisworld.com/entity-framework-and-setting-primary-keys-on-views/\n","permalink":"http://localhost:1313/posts/entityframework-reverse-poco-generator-and-views/","summary":"\u003cp\u003eEntityFramework’s own tool to generate a model from a database is slow and buggy. It’s particularly a problem if you update your database (change table names, field names etc.).\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://visualstudiogallery.msdn.microsoft.com/ee4fcff9-0c4c-4179-afd9-7a2fb90f5838\"\u003eEntityFramework Reverse POCO Generator\u003c/a\u003e is a great, lightweight replacement – it’s fast, configurable and just works. Also, the entities created can be the same as those created by the built in tool, so it is possible to switch to it part way through developing a project.\u003c/p\u003e","title":"EntityFramework Reverse POCO Generator and Views"},{"content":"Omu.ValueInjecter is great for quickly casting one entity to another, especially when the property names match up, as there’s no configuration to do.\nThis is really handy if you have a view model that’s just a cut down version of your model and you want to get the data from the model into the view model.\nIf you’ve got a list of model entities that you want to cast to a list of view model entitites, you can do so without looping through them:\nvar MyViewModels = db.MyModel.ToList().Select(p =\u0026gt; new MyViewModel().InjectFrom(p)).Cast\u0026lt;MyViewModel\u0026gt;(); Based on this:\nhttp://stackoverflow.com/questions/5443763/valueinjecter-with-iqueryablet\n","permalink":"http://localhost:1313/posts/casting-one-list-to-another-with-omu.valueinjecter/","summary":"\u003cp\u003eOmu.ValueInjecter is great for quickly casting one entity to another, especially when the property names match up, as there’s no configuration to do.\u003c/p\u003e\n\u003cp\u003eThis is really handy if you have a view model that’s just a cut down version of your model and you want to get the data from the model into the view model.\u003c/p\u003e\n\u003cp\u003eIf you’ve got a list of model entities that you want to cast to a list of view model entitites, you can do so without looping through them:\u003c/p\u003e","title":"Casting one list to another with Omu.ValueInjecter"},{"content":" Create the database\nCreate the project/solution in Visual Studio\ndon’t give the project the same name (in the same case) as one of the tables or the compiler will become confused between types and namespaces choose MVC and optionally Web API and unit tests leave authentication as Individual User Accounts Create an application in IIS that points to the project\nChange the Web properties for the project to use Local IIS\nUpdate all Nuget packages in all projects in the solution\nAdd the CAS Nuget package\nUpdate the web.config configuration/system.web/authentication/forms configuration/casClientConfig AppStart\\FilterConfig.cs – add filters.Add(new System.Web.Mvc.AuthorizeAttribute()); See https://mikebarram.wordpress.com/2014/02/28/requiring-authentication-for-a-whole-asp-net-mvc-site/ Edit Controllers\\AccountController.cs – mostly copy from existing applications Add Session_Start to global.asax.cs Create Views\\Shared\\NotAuthorised.cshtml Create Role Provider if needed Web.config\nAdd \u0026lt;pages controlRenderingCompatibilityVersion=”4.0″ /\u0026gt; to System.Web Add Nuget TinyMCE.JQuery\nSee https://mikebarram.wordpress.com/2014/03/18/adding-wysiyyg-editors-to-text-fields-in-mvc/\nCreate folder Views\\Shared\\EditorTemplates\nCreate 1 line template file WYSIWYG.cshtml @Html.TextArea(“”, new { @class = “wysiwyg” })\nCreate a bundle for TinyMCE in App_Start\\BundleConfig.cs\nbundles.Add(new ScriptBundle(\u0026#34;~/bundles/tinymce\u0026#34;).Include( \u0026#34;~/Scripts/tinymce/tinymce.min.js\u0026#34;)); Add favicon.ico to root\nAdd logo.png and user.png to Content (remember to include them in the project)\nUpdate Content\\site.css from an application that the new project should look like\nCreate your data model\nDon’t copy the connection string from another project as that will contain the details of the model in that project. Instead, create a new connection string for your model (you can copy the details of the server from an old connection string) When editing the entity model diagram, you can change the Entity Container Name to something more friendly and that will change the name of the connection string in the web.config If a connection string called “DefaultConnection” has been created in the web.config, you will want to update Models\\IdentityModels.cs to use your main connection string instead of that one – this will be the connection string that you have just set the name of in the step above. Start creating controllers and views…\nAuditing – if you want to automatically set the values in certain fields if they have set names (e.g. createddate):\nCreate a folder called Helpers Create a partial class that overrides the SaveChanges() method of the entities (copy and modify from existing project). Method is loosely based on http://stackoverflow.com/questions/7641552/overriding-savechanges-and-setting-modifieddate-but-how-do-i-set-modifiedby ","permalink":"http://localhost:1313/posts/steps-in-creating-a-new-mvc-application/","summary":"\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eCreate the database\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreate the project/solution in Visual Studio\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edon’t give the project the same name (in the same case) as one of the tables or the compiler will become confused between types and namespaces\u003c/li\u003e\n\u003cli\u003echoose MVC and optionally Web API and unit tests\u003c/li\u003e\n\u003cli\u003eleave authentication as Individual User Accounts\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreate an application in IIS that points to the project\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eChange the Web properties for the project to use Local IIS\u003c/p\u003e","title":"Steps in creating a new MVC application"},{"content":"If you use Visual Studio to generate MVC views, it will use T4 templates. This is how to edit those templates.\nGo to:\nC:\\Program Files (x86)\\Microsoft Visual Studio 12.0\\Common7\\IDE\\Extensions\\Microsoft\\Web\\Mvc\\Scaffolding\\Templates\\MvcView\nMake a backup copy of the folder (don’t put the backup inside the folder or VS will complain that it has multiple templates to choose from)\nThen, open all of the files (or at least all of the *.cs.t4) files) in a text editor.\nYou can now modify the templates. I like to:\nadd the class “btn-primary” to submit buttons on edit and create views add the class”btn-warning” on delete views add \u0026lt;thead\u0026gt;\u0026lt;/thead\u0026gt; and \u0026lt;tbody\u0026gt;\u0026lt;/tbody\u0026gt; tags to List.cs.t4 – why does the template not have semantic markup? add the class “edit-details-delete” to the last \u0026lt;th\u0026gt;\u0026lt;/th\u0026gt; in List.cs.t4 – this lets me use CSS to set the “action” column to a fixed width NOTE: installing Visual Studio 2013 update 2 will overwrite your templates. The new templates have extra bootstrap classes but not the ones above. They also turn enums into dropdowns, so you’ll probably want to use the new templates rather than overwriting them with a backup.\n","permalink":"http://localhost:1313/posts/changing-the-templates-used-to-generate-mvc-views/","summary":"\u003cp\u003eIf you use Visual Studio to generate MVC views, it will use T4 templates. This is how to edit those templates.\u003c/p\u003e\n\u003cp\u003eGo to:\u003c/p\u003e\n\u003cp\u003eC:\\Program Files (x86)\\Microsoft Visual Studio 12.0\\Common7\\IDE\\Extensions\\Microsoft\\Web\\Mvc\\Scaffolding\\Templates\\MvcView\u003c/p\u003e\n\u003cp\u003eMake a backup copy of the folder (don’t put the backup inside the folder or VS will complain that it has multiple templates to choose from)\u003c/p\u003e\n\u003cp\u003eThen,  open all of the files (or at least all of the *.cs.t4) files) in a text editor.\u003c/p\u003e","title":"Changing the templates used to generate MVC views"},{"content":"In ASP.Net MVC, the data model can use data annotations to describe how a property should be displayed or validated.\n[DisplayName(\u0026quot;Label used for field goes here\u0026quot;)]\nIf a string field in the database (e.g. varchar()) doesn’t allow nulls you should either have\n[Required(ErrorMessage = \u0026quot;Required\u0026quot;)] to provide a message when a field hasn’t been entered\nor\n[DisplayFormat(ConvertEmptyStringToNull = false)] if empty strings are allowed (though you might want to allow nulls if that’s the case)\n[StringLength(255, ErrorMessage = \u0026quot;Maximum chars 255\u0026quot;)]\n[Range(0.01, 100.00, ErrorMessage = \u0026quot;Price must be between 0.01 and 100.00\u0026quot;)]\n[DisplayFormat(DataFormatString = \u0026quot;{0:dd/MM/yyyy}\u0026quot;)]\n[DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = \u0026quot;{0:dd/MM/yyyy}\u0026quot;)]\n[DataType(DataType.MultilineText)] – the editor will be a textarea\nIf your text includes HTML then you’ll need\n[AllowHtml]\nAnd you might want to use a custom WYSIWYG editor\n[UIHint(\u0026quot;WYSIWYG_basic\u0026quot;)]\nThere are lots of other data annotations for different data types such as EmailAddress or ImageUrl:\nhttp://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.datatype(v=vs.110).aspx\nYou may want to add UI Hints for some of these data types, so that for an image, say, you use a template that displays the image when viewing but lets you upload/replace the image when editing:\nhttps://digitaltoolfactory.net/blog/2012/04/how-to-use-ui-hints-and-display-templates-in-asp-net-mvc-3/\nMore on data annotations:\nhttp://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application\nhttp://www.asp.net/mvc/tutorials/mvc-music-store/mvc-music-store-part-6\n","permalink":"http://localhost:1313/posts/typical-data-annotations-to-use-in-an-mvc-data-model/","summary":"\u003cp\u003eIn ASP.Net MVC, the data model can use data annotations to describe how a property should be displayed or validated.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e[DisplayName(\u0026quot;Label used for field goes here\u0026quot;)]\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eIf a string field in the database (e.g. varchar()) doesn’t allow nulls you should either have\u003cbr\u003e\n\u003ccode\u003e[Required(ErrorMessage = \u0026quot;Required\u0026quot;)]\u003c/code\u003e to provide a message when a field hasn’t been entered\u003cbr\u003e\nor\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e[DisplayFormat(ConvertEmptyStringToNull = false)]\u003c/code\u003e if empty strings are allowed (though you might want to allow nulls if that’s the case)\u003c/p\u003e","title":"Typical data annotations to use in an MVC data model"},{"content":"In a previous post I showed how you could set attributes on properties in an MVC model so that a text field would be edited with a multi-line HTML text box, instead of a single line input field.\nWhat if the you text you’re editing is HTML and you want to use an HTML editor? In the edit razor view, you could set some HTML attributes (e.g. CSS class) on the @Html.EditorFor() but you would have to do that on every view where you edit the field, and on every field that you want to use an HTML editor for. So this shows how to add an attribute to a property so that, wherever the property is edited, the HTML editor will be used.\nJust as in the previous post, you add an attribute to a meta data class. To edit a text field with a multi-line text box you had these attributes:\n[AllowHtml] [DataType(DataType.MultilineText)] public string htmlField { get; set; } So for a WYSIWYG editor you can add a UI hint:\n[UIHint(\u0026#34;WYSIWYG_basic\u0026#34;), AllowHtml] public string htmlField { get; set; } That UI hint tells MVC to look for a custom editor template for that property. In this case the editor should be called \\Views\\Shared\\EditorTemplates\\WYSIWYG_basic.cshtml\nIn this case, the editor template is simply:\n@Html.TextArea(\u0026#34;\u0026#34;, new { @class = \u0026#34;wysiwyg basic\u0026#34; }) This means that the property will be edited with a text area that has the classes wysiwyg and basic\nI then installed the nuget package TinyMCE.jQuery\nIn the _layout view, I told TinyMCE to convert anything with a class of “wysiwyg” to a TinyMCE editor:\nYou also have to remember to reference the TinyMCE javascript library. I did that by creating a bundle in App_Start\\BundleConfig.cs\nbundles.Add(new ScriptBundle(\u0026#34;~/bundles/tinymce\u0026#34;).Include( \u0026#34;~/Scripts/tinymce/tinymce.min.js\u0026#34;)); And then adding that bundle in the _layout view:\n@Scripts.Render(\u0026#34;~/bundles/tinymce\u0026#34;) ","permalink":"http://localhost:1313/posts/adding-wysiyyg-editors-to-text-fields-in-mvc/","summary":"\u003cp\u003eIn a \u003ca href=\"https://mike.barram.dev/blog/2014/multiline-text-editor-in-mvc\"\u003eprevious post\u003c/a\u003e I showed how you could set attributes on properties in an MVC model so that a text field would be edited with a multi-line HTML text box, instead of a single line input field.\u003c/p\u003e\n\u003cp\u003eWhat if the you text you’re editing is HTML and you want to use an HTML editor? In the edit razor view, you could set some HTML attributes (e.g. CSS class) on the @Html.EditorFor() but you would have to do that on every view where you edit the field, and on every field that you want to use an HTML editor for. So this shows how to add an attribute to a property so that, wherever the property is edited, the HTML editor will be used.\u003c/p\u003e","title":"Adding WYSIYYG editors to text fields in MVC"},{"content":"https://developers.google.com/chrome-developer-tools/docs/mobile-emulation\nThis is great for testing responsive designs. It allows for device pixel ratios, so you’ll get a much better idea of what your site will look like than just by resizing your browser.\n","permalink":"http://localhost:1313/posts/mobile-emulation-in-chrome/","summary":"\u003cp\u003e\u003ca href=\"https://developers.google.com/chrome-developer-tools/docs/mobile-emulation\"\u003ehttps://developers.google.com/chrome-developer-tools/docs/mobile-emulation\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis is great for testing responsive designs. It allows for device pixel ratios, so you’ll get a much better idea of what your site will look like than just by resizing your browser.\u003c/p\u003e","title":"Mobile emulation in Chrome"},{"content":"This is easy from ASP.NET MVC 4 onwards:\nhttp://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx\nYou can register a filter that will require users to be authenticated to access all controllers\npublic static void RegisterGlobalFilters(GlobalFilterCollection filters) { filters.Add(new HandleErrorAttribute()); filters.Add(new System.Web.Mvc.AuthorizeAttribute()); } but then they won’t be able to access to the Login controller, so you simply add the [AllowAnonymous] attribute to that controller:\n[AllowAnonymous] public ActionResult Login(string returnUrl) [HttpPost] [AllowAnonymous] [ValidateAntiForgeryToken] public ActionResult Login(LoginModel model, string returnUrl) ","permalink":"http://localhost:1313/posts/requiring-authentication-for-a-whole-asp.net-mvc-site/","summary":"\u003cp\u003eThis is easy from ASP.NET MVC 4 onwards:\u003cbr\u003e\n\u003ca href=\"http://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx\"\u003ehttp://blogs.msdn.com/b/rickandy/archive/2012/03/23/securing-your-asp-net-mvc-4-app-and-the-new-allowanonymous-attribute.aspx\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eYou can register a filter that will require users to be authenticated to access all controllers\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estatic\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e RegisterGlobalFilters(GlobalFilterCollection filters)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    filters.Add(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e HandleErrorAttribute());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    filters.Add(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e System.Web.Mvc.AuthorizeAttribute());\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ebut then they won’t be able to access to the Login controller, so you simply add the [AllowAnonymous] attribute to that controller:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e[AllowAnonymous]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e ActionResult Login(\u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e returnUrl)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e[HttpPost]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e[AllowAnonymous]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003e[ValidateAntiForgeryToken]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003epublic\u003c/span\u003e ActionResult Login(LoginModel model, \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e returnUrl)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Requiring authentication for a whole ASP.Net MVC site"},{"content":"In ASP.Net MVC, it’s so easy to create an entity data model and generate controllers and views for each entity. You can create lots of pages for editing your data just by clicking buttons…\nA downside is that the generated code doesn’t know the the difference between a small string and a large one, so you get the same small text input box to edit all strings.\nIn your razor view, that’s created by\n@Html.EditorFor(model =\u0026gt; model.YourTextField) This http://stackoverflow.com/questions/4927003/asp-net-mvc3-textarea-with-html-editorfor explains that you can set a [DataType] attribute on the view model e.g.\npublic class MyViewModel { [DataType(DataType.MultilineText)] public string YourTextField{ get; set; } } But, if your view model has been generated, you can’t edit it (or at least your changes will be reverted when you re-generate the model from the database).\nFortunately, this http://stackoverflow.com/questions/16736494/add-data-annotations-to-a-class-generated-by-entity-framework explains how to create a second partial class that lets you set the data attributes\nnamespace SameNamespace.Models { [MetadataType(typeof(YourClassMetaData))] public partial class YourClass { } public class YourClassMetaData { [DataType(DataType.MultilineText)] public string YourTextField { get; set; } } } If you’re not displaying data directly from a model but from a view model, then the field in the view model will need the data attribute.\nAt the same time, if the text box is for HTML, you might want to add the [AllowHtml] attribute to the property. If you then get the error “A potentially dangerous Request.Form value was detected”, you may need to set this in the web.config:\nA simpler way, but one that won’t globally affect the way the field is displayed, is to use:\n@Html.TextAreaFor(model =\u0026gt; model.YourTextField, new { cols = 80, @rows = 15 }) ","permalink":"http://localhost:1313/posts/multiline-text-editor-in-mvc/","summary":"\u003cp\u003eIn ASP.Net MVC, it’s so easy to create an entity data model and generate controllers and views for each entity. You can create lots of pages for editing your data just by clicking buttons…\u003c/p\u003e\n\u003cp\u003eA downside is that the generated code doesn’t know the the difference between a small string and a large one, so you get the same small text input box to edit all strings.\u003c/p\u003e\n\u003cp\u003eIn your razor view, that’s created by\u003c/p\u003e","title":"Multiline Text Editor in MVC"},{"content":"Our FormViews in ASP.Net web forms tend to contain user controls in the templates.\nIf you want to want to intercept the insert or update events, you end up with something like:\nprotected void FormView1_ItemUpdating(object sender, FormViewUpdateEventArgs e) { } But how do you access the values in the user control? We’ve often had code like this:\nTextBox tReviewerName = (TextBox)FormView1.Row.FindControl(\u0026#34;dataReviewerName\u0026#34;); which is OK to get the value from that field if you want to code your own updates/inserts but you can’t (I think) write back to that field in time for the update to pass that new value back to the database.\nThe better/correct way to update the data is like so:\nprotected void FormView1_ItemUpdating(object sender, FormViewUpdateEventArgs e) { string sOut = e.NewValues[\u0026#34;ReviewerName\u0026#34;].ToString(); sOut = sOut.Replace(\u0026#34;rude word\u0026#34;, \u0026#34;kitten\u0026#34;); e.NewValues[\u0026#34;ReviewerName\u0026#34;] = sOut; } ","permalink":"http://localhost:1313/posts/intercepting-formview-inserts-and-updates/","summary":"\u003cp\u003eOur FormViews in ASP.Net web forms tend to contain user controls in the templates.\u003c/p\u003e\n\u003cp\u003eIf you want to want to intercept the insert or update events, you end up with something like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eprotected\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e FormView1_ItemUpdating(\u003cspan style=\"color:#66d9ef\"\u003eobject\u003c/span\u003e sender, FormViewUpdateEventArgs e)  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eBut how do you access the values in the user control? We’ve often had code like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eTextBox tReviewerName = (TextBox)FormView1.Row.FindControl(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dataReviewerName\u0026#34;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ewhich is OK to get the value from that field if you want to code your own updates/inserts but you can’t (I think) write back to that field in time for the update to pass that new value back to the database.\u003c/p\u003e","title":"Intercepting FormView inserts and updates"},{"content":"From http://stackoverflow.com/tags/automapper/info\nAutoMapper uses a fluent configuration API to define an object-object mapping strategy. AutoMapper uses a convention-based matching algorithm to match up source to destination values. Currently, AutoMapper is geared towards model projection scenarios to flatten complex object models to DTOs and other simple objects, whose design is better suited for serialization, communication, messaging, or simply an anti-corruption layer between the domain and application layer.\nSlightly slow but useful video to show how AutoMapper is useful\nhttp://dnrtv.com/player/player.aspx?ShowNum=0155\nNote that the video is for v1 from 2009\nDemonstrates how you can easily create an object that is a flattened view of a number of base objects – particularly useful for presentation of data or transferring data to a client as JSON in simple flat structure.\n@26 minutes – a nice way to conditionally format text e.g. showing singular/plural or converting dates to strings.\n","permalink":"http://localhost:1313/posts/automapper/","summary":"\u003cp\u003eFrom \u003ca href=\"http://stackoverflow.com/tags/automapper/info\"\u003ehttp://stackoverflow.com/tags/automapper/info\u003c/a\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAutoMapper uses a fluent configuration API to define an object-object mapping strategy. AutoMapper uses a convention-based matching algorithm to match up source to destination values. Currently, AutoMapper is geared towards model projection scenarios to flatten complex object models to DTOs and other simple objects, whose design is better suited for serialization, communication, messaging, or simply an anti-corruption layer between the domain and application layer.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSlightly slow but useful video to show how AutoMapper is useful\u003c/p\u003e","title":"AutoMapper"},{"content":"“NuGet is a Visual Studio extension that makes it easy to add, remove, and update libraries and tools in Visual Studio projects that use the .NET Framework.” http://docs.nuget.org/\nTo be as agile as possible, the projects developed by the team tend to be coded as separate .Net projects, rather than within one over-arching framework. This makes it easy, when starting a project, to copy the elements from the most similar existing project and just get on with it, without worrying about breaking existing applications. The downside to this is that bugs that are identified and fixed in one project may also need to be fixed in many other projects. In the same way, design changes (updates to templates) need to be rolled out across many sites. Updates to libraries such as jQuery or .Net need to be rolled out across many sites too but there can be an advantage in that, as testing can be done in smaller chunks before the new version can go live – plus the rule of, if it ain’t broke, don’t fix it, can be applied to the older projects that don’t have any other reason to be updated.\nIn an effort to consolidate the framework code that we use in all/most of our sites, I’ve investigated using NuGet. The idea is to bundle code, and even CSS files, into packages, which are hosted in a central repository. Each project then includes the packages that are needed (e.g. CAS authentication) and whenever the project is edited, Visual Studio checks to see if there is a newer version of the package. This is just like using plugins in WordPress. So, I just had to work out how to package my code…\nFirst, you want 3 NuGet applications:\nThe first is the Visual Studio extension that allows you to download NuGet packages. You’ll want this anyway, to download packages such as Entity Framework, jQuery etc. It’s probably already bundled with your copy of Visual Studio The second is NuGet.exe, which is used to create NuGet packages. This is optional, as you can right click a solution and select “Enable NuGet Package Restore” The third is NuGet Package Explorer, which makes it easier to edit the basic package that NuGet.exe creates To create my first NuGet package, I created a Class Library solution in Visual Studio. The class I created was nice and simple:\nnamespace MhsWebTeam.CasAuthentication { public class TestMe { public static string GetTestString() { return \u0026#34;Hello from the CasAuthentication NuGet!\u0026#34;; } } } Then I followed the instructions here: http://russellallen.info/post/2013/01/12/Complete-Idiots-Guide-to-Creating-and-publishing-a-NuGet-package.aspx\n(there are also instructions here http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package)\nThis gave me my first .Nupkg package file.\nA folder on a network share was nominated to be the team’s repository of nuggets.\nVisual Studio was then configured to point to this local repository – http://docs.nuget.org/docs/creating-packages/hosting-your-own-nuget-feeds\nThe local packages can then be installed in any Visual Studio project and, best of all, Visual Studio will recognise when a newer version of a package is available.\nI created a new MVC project and installed the new Nuget in it. To get the Index.cshtml file to display the content from the static method I created, I added:\n@MhsWebTeam.CasAuthentication.TestMe.GetTestString() I could then test that the package updated sucessfully by editing the method in the original project and recompiling. Then NuGet Package Explorer was used to update the package, making sure it contained the updated dll, and the package was saved as a new file with a new version number. The new .nupkg file was copied to the local repository and, whilst I wasn’t warned that there was a new version of the package as soon as I opened the project, the update was found straight away when I right clicked on the project and selected “Manage NuGet Packages” and selected all updates. It was then a single click to update to the new version.\nThis is fine as a way of keeping our projects up to date with our latest dll’s but next I’ve got to work out how to package content, scripts, configurations etc.\nIt’s all explained here http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package so hopefully not too hard… Editing config files with XDT stuff is just the same as you do with web.config.debug and web.config.release files.\n","permalink":"http://localhost:1313/posts/nugets-of-gold/","summary":"\u003cp\u003e“NuGet is a Visual Studio extension that makes it easy to add, remove, and update libraries and tools in Visual Studio projects that use the .NET Framework.” http://docs.nuget.org/\u003c/p\u003e\n\u003cp\u003eTo be as agile as possible, the projects developed by the team tend to be coded as separate .Net projects, rather than within one over-arching framework. This makes it easy, when starting a project, to copy the elements from the most similar existing project and just get on with it, without worrying about breaking existing applications. The downside to this is that bugs that are identified and fixed in one project may also need to be fixed in many other projects. In the same way, design changes (updates to templates) need to be rolled out across many sites. Updates to libraries such as jQuery or .Net need to be rolled out across many sites too but there can be an advantage in that, as testing can be done in smaller chunks before the new version can go live – plus the rule of, if it ain’t broke, don’t fix it, can be applied to the older projects that don’t have any other reason to be updated.\u003c/p\u003e","title":"NuGets of gold"},{"content":"Reading to do relating to frameworks for Rich Internet Applications…\nVisual Studio 2013 bundles Knockout.js, which looks fairly straightforward (I hope)\nPostal could be a better way of handling the events https://github.com/postaljs/postal.js\nNeed to make sure our applications are accessible: http://stackoverflow.com/questions/7370056/accessibility-and-all-these-javascript-frameworks\nWith Knockout, you can pass the server side model to the client like this:\n\u0026lt;script\u0026gt; ko.applyBindings(@Html.ToJSON(Model)); \u0026lt;/script\u0026gt; Comparison of frameworks\nhttp://blog.stevensanderson.com/2012/08/01/rich-javascript-applications-the-seven-frameworks-throne-of-js-2012/\nYet more from the developers at Twitter http://twitter.github.io/hogan.js/. This is a compiler for {{mustache}}, which is a templating language that can convert JSON to HTML in a similar way to Razor converting entities to HTML in ASP.Net. Useful if you want to say generate whole data grids on the client. If your server is getting JSON from elsewhere and you want to template it into HTML, you can use mustache templates on the server (rather than client) using https://github.com/jdiamond/Nustache\nhttp://www.asp.net/single-page-application/overview/introduction/knockoutjs-template\nTypeScript\nhttp://channel9.msdn.com/posts/Anders-Hejlsberg-Introducing-TypeScript\nhttp://www.dotnetcurry.com/showarticle.aspx?ID=939\nDurandal\nhttp://durandaljs.com/\nhttp://herdingcode.com/herding-code-182-durandal-kickstarter-with-rob-eisenberg/ (Notes here: http://lazycoder.com/weblog/)\n","permalink":"http://localhost:1313/posts/frameworks-for-rich-internet-applications/","summary":"\u003cp\u003eReading to do relating to frameworks for Rich Internet Applications…\u003c/p\u003e\n\u003cp\u003eVisual Studio 2013 bundles Knockout.js, which looks fairly straightforward (I hope)\u003c/p\u003e\n\u003cp\u003ePostal could be a better way of handling the events https://github.com/postaljs/postal.js\u003c/p\u003e\n\u003cp\u003eNeed to make sure our applications are accessible:  http://stackoverflow.com/questions/7370056/accessibility-and-all-these-javascript-frameworks\u003c/p\u003e\n\u003cp\u003eWith Knockout, you can pass the server side model to the client like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-HTML\" data-lang=\"HTML\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eko\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eapplyBindings\u003c/span\u003e(\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eHtml\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eToJSON\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eModel\u003c/span\u003e));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eComparison of frameworks\u003cbr\u003e\n\u003ca href=\"http://blog.stevensanderson.com/2012/08/01/rich-javascript-applications-the-seven-frameworks-throne-of-js-2012/\"\u003ehttp://blog.stevensanderson.com/2012/08/01/rich-javascript-applications-the-seven-frameworks-throne-of-js-2012/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eYet more from the developers at Twitter \u003ca href=\"http://twitter.github.io/hogan.js/\"\u003ehttp://twitter.github.io/hogan.js/\u003c/a\u003e. This is  a compiler for \u003ca href=\"http://mustache.github.io/\"\u003e{{mustache}}\u003c/a\u003e, which is a templating language that can convert JSON to HTML in a similar way to Razor converting entities to HTML in ASP.Net. Useful if you want to say generate whole data grids on the client. If your server is getting JSON from elsewhere and you want to template it into HTML, you can use mustache templates on the server (rather than client) using \u003ca href=\"https://github.com/jdiamond/Nustache\"\u003ehttps://github.com/jdiamond/Nustache\u003c/a\u003e\u003c/p\u003e","title":"Frameworks for Rich Internet Applications"},{"content":"There are 3 ways to link entity framework to a database:\nDatabase first. Point Visual Studio at your database and it will create an entity model for you. Code first. Write your classes in Visual Studio and it can create your database for you. Model first. Use the Entity Data Model Tool in Visual Studio to model your entities. Visual Studio will can them create your database and classes for you. I’ve just tried Model First and not achieved what I wanted.\nWhat did work:\nFollowing the instructions in this video I created a model, which looked similar to a database diagram. I then automatically generated a database from the model. At the same time, classes were created. I could update the model and then recreate the database. What didn’t work:\nBeing able to modify the database after changing the model. If the tables contain data, I would want Visual Studio to create the scripts to alter tables, rather than drop and re-create them. Model first doesn’t let you create a migration script.\nThis http://www.nuget.org/packages/CodeSecond might help with doing that.\nThis problem is described here http://stackoverflow.com/questions/15014705/how-to-manage-entity-framework-model-first-schema-updates, so perhaps you need a tool like http://www.devart.com/entitydeveloper/product-tour.html\nOr, I could use code first instead…\nThe generated classes\nThe same entities as Simon’s model but created using the Entity Data Model Tool\n[]\nGenerated Parent class\n[]\nGenerated Child class\n[]\nGenerated Singleton class\nParent uses ICollection\u0026lt;Child\u0026gt; instead of List\u0026lt;Child\u0026gt; Also, when a new Parent is initialised, the class creates new HashSets of related entities.\nJust to show that model first can create a database – here it is:\n[]\nDatabase generated from the model, looking just like the one Simon generated from code\nPerhaps, if you really don’t like writing classes (I’d prefer to use a visual designer), you could use model first to create the code for the classes and then copy those classes into a project that uses code first…\nAnother alternative would be to use model first but when you want to make changes to the database, make those changes in the database and then tell the model to update itself.\nUseful documentation:\nEntity Framework (EF) Documentation\nhttp://stackoverflow.com/questions/5446316/code-first-vs-model-database-first\n","permalink":"http://localhost:1313/posts/entity-framework-model-first/","summary":"\u003cp\u003eThere are 3 ways to link entity framework to a database:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eDatabase first\u003c/strong\u003e. Point Visual Studio at your database and it will create an entity model for you.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCode first\u003c/strong\u003e. Write your classes in Visual Studio and it can create your database for you.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eModel first\u003c/strong\u003e. Use the Entity Data Model Tool in Visual Studio to model your entities. Visual Studio will can them create your database and classes for you.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eI’ve just tried \u003cstrong\u003eModel First\u003c/strong\u003e and not achieved what I wanted.\u003c/p\u003e","title":"Entity Framework – Model First"},{"content":"If you need to dynamically create HTML emails (say for a new announcements system), the first thing to do is question whether you really need to or if any other alternative will do. This is especially the case if you’re going to give users a WYSIWYG editor to create marked up content.\nSome useful resources:\nhttp://webdesign.tutsplus.com/tutorials/htmlcss-tutorials/say-hello-to-the-html-email-boilerplate/\nhttp://24ways.org/2009/rock-solid-html-emails/\nhttp://htmlemailboilerplate.com/\nhttps://litmus.com/blog/16-tips-troubleshooting-html-email\nhttps://templates.campaignmonitor.com/build/\nhttp://www.campaignmonitor.com/css/\nhttp://premailer.dialect.ca/ – converts CSS to inline styles\nhttps://litmus.com/email-testing – get screenshots of your email in different clients\n","permalink":"http://localhost:1313/posts/html-emails/","summary":"\u003cp\u003eIf you need to dynamically create HTML emails (say for a new announcements system), the first thing to do is question whether you really need to or if any other alternative will do. This is especially the case if you’re going to give users a WYSIWYG editor to create marked up content.\u003c/p\u003e\n\u003cp\u003eSome useful resources:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://webdesign.tutsplus.com/tutorials/htmlcss-tutorials/say-hello-to-the-html-email-boilerplate/\"\u003ehttp://webdesign.tutsplus.com/tutorials/htmlcss-tutorials/say-hello-to-the-html-email-boilerplate/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://24ways.org/2009/rock-solid-html-emails/\"\u003ehttp://24ways.org/2009/rock-solid-html-emails/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://htmlemailboilerplate.com/\"\u003ehttp://htmlemailboilerplate.com/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://litmus.com/blog/16-tips-troubleshooting-html-email\"\u003ehttps://litmus.com/blog/16-tips-troubleshooting-html-email\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://templates.campaignmonitor.com/build/\"\u003ehttps://templates.campaignmonitor.com/build/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.campaignmonitor.com/css/\"\u003ehttp://www.campaignmonitor.com/css/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://premailer.dialect.ca/\"\u003ehttp://premailer.dialect.ca/\u003c/a\u003e – converts CSS to inline styles\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://litmus.com/email-testing\"\u003ehttps://litmus.com/email-testing\u003c/a\u003e – get screenshots of your email in different clients\u003c/p\u003e","title":"HTML emails"},{"content":"Public Sub Convert_To_Hyperlinks() Dim Cell As Range For Each Cell In Intersect(Selection, ActiveSheet.UsedRange) If Cell \u0026lt;\u0026gt; \u0026#34;\u0026#34; Then ActiveSheet.Hyperlinks.Add Cell, Cell.Value End If Next End Sub ","permalink":"http://localhost:1313/posts/convert-urls-to-hyperlinks-in-excel-using-vba/","summary":"\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-vbs\" data-lang=\"vbs\"\u003ePublic Sub Convert_To_Hyperlinks()\n    Dim Cell As Range\n    For Each Cell In Intersect(Selection, ActiveSheet.UsedRange)\n        If Cell \u0026lt;\u0026gt; \u0026#34;\u0026#34; Then\n            ActiveSheet.Hyperlinks.Add Cell, Cell.Value\n        End If\n    Next\nEnd Sub\n\u003c/code\u003e\u003c/pre\u003e","title":"Convert URLs to hyperlinks in Excel using VBA"},{"content":"Querying across databases using linked servers should be easy:\nhttp://stackoverflow.com/questions/4091960/sql-server-linked-server-example-query\nbut linking SQL Server 2008 (64 bit) to SQL Server 2000 (SP3 I think) results in an error:\nCannot obtain the schema rowset “DBSCHEMA_TABLES_INFO” for OLE DB provider “SQLNCLI10” for linked server…\nTo get around this the old server needs a stored procedure as follows:\ncreate procedure dbo.sp_tables_info_rowset_64 @table_name sysname, @table_schema sysname = null, @table_type nvarchar(255) = null as declare @Result int set @Result = 0 exec @Result = sp_tables_info_rowset @table_name, @table_schema, @table_type go as described here:\nhttp://sqlblog.com/blogs/roman_rehak/archive/2009/05/10/issue-with-64-bit-sql-server-using-sql-2000-linked-server.aspx\nThe account you’re using for the linked server also needs permission to execute the stored procedure.\n","permalink":"http://localhost:1313/posts/linked-servers-in-sql-server/","summary":"\u003cp\u003eQuerying across databases using linked servers should be easy:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/4091960/sql-server-linked-server-example-query\"\u003ehttp://stackoverflow.com/questions/4091960/sql-server-linked-server-example-query\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ebut linking SQL Server  2008 (64 bit) to SQL Server 2000 (SP3 I think) results in an error:\u003c/p\u003e\n\u003cp\u003eCannot obtain the schema rowset “DBSCHEMA_TABLES_INFO” for OLE DB provider “SQLNCLI10” for linked server…\u003c/p\u003e\n\u003cp\u003eTo get around this the old server needs a stored procedure as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-SQL\" data-lang=\"SQL\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ecreate\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eprocedure\u003c/span\u003e dbo.sp_tables_info_rowset_64  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etable_name\u003c/span\u003e sysname,  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003etable_schema     sysname \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e,  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003etable_type nvarchar(\u003cspan style=\"color:#ae81ff\"\u003e255\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edeclare\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eResult\u003c/span\u003e int \u003cspan style=\"color:#66d9ef\"\u003eset\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eResult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eexec\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eResult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e sp_tables_info_rowset \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003etable_name\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003etable_schema, \u003cspan style=\"color:#f92672\"\u003e@\u003c/span\u003etable_type  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ego\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eas described here:\u003c/p\u003e","title":"Linked servers in SQL Server"},{"content":"Response.StatusCode = 301 Response.Redirect(\u0026#34;http:////www.NewLocation.com\u0026#34;) \u0026#39;\u0026#39;\u0026#39; doesn’t result in a status code of 301, so do it this way: ```C# Response.Status = \u0026#34;301 Moved Permanently\u0026#34;; Response.AddHeader(\u0026#34;Location\u0026#34;,\u0026#34;http:////www.NewLocation.com\u0026#34;); Response.End(); thanks to:\nhttp://www.vikramlakhotia.com/Search_Engine_Web_World_and_301_redirect.aspx\nIn ASP.Net 4 you can use Response.RedirectPermanent()\nIn ASP the code would be:\n\u0026lt;%@ Language=VBScript %\u0026gt; \u0026lt;% Response.Clear Response.Status=”301 Moved Permanently” Response.AddHeader “Location”,”http://www.address\\_to\\_redirect\\_to/” %\u0026gt; ","permalink":"http://localhost:1313/posts/status-code-301-moved-permanently-in-asp.net/","summary":"\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eResponse.StatusCode = \u003cspan style=\"color:#ae81ff\"\u003e301\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eResponse.Redirect(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http:////www.NewLocation.com\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edoesn\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e’\u003c/span\u003et result \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e a status code of \u003cspan style=\"color:#ae81ff\"\u003e301\u003c/span\u003e, so \u003cspan style=\"color:#66d9ef\"\u003edo\u003c/span\u003e it \u003cspan style=\"color:#66d9ef\"\u003ethis\u003c/span\u003e way:  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e```\u003c/span\u003eC\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eResponse.Status = \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;301 Moved Permanently\u0026#34;\u003c/span\u003e;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eResponse.AddHeader(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Location\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;http:////www.NewLocation.com\u0026#34;\u003c/span\u003e);  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eResponse.End();\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ethanks to:\u003cbr\u003e\n\u003ca href=\"http://www.vikramlakhotia.com/Search\"\u003ehttp://www.vikramlakhotia.com/Search\u003c/a\u003e_Engine_Web_World_and_301_redirect.aspx\u003c/p\u003e\n\u003cp\u003eIn ASP.Net 4 you can use Response.RedirectPermanent()\u003c/p\u003e\n\u003cp\u003eIn ASP the code would be:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-ASP\" data-lang=\"ASP\"\u003e\u0026lt;%@ Language=VBScript %\u0026gt;  \n\u0026lt;%  \nResponse.Clear  \nResponse.Status=”301 Moved Permanently”  \nResponse.AddHeader “Location”,”http://www.address\\_to\\_redirect\\_to/”  \n%\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e","title":"Status code 301 “moved permanently” in ASP.Net"},{"content":"As described here:\nhttp://paulirish.com/2008/the-two-css-selector-bugs-in-ie6/\nif you write\n#tooltip.red { background: white; color: red; } #tooltip.yellow { background: black; color: red; } the second rule will be ignored\n","permalink":"http://localhost:1313/posts/the-weirdest-ie6-css-bug-the-multiple-class-bug/","summary":"\u003cp\u003eAs described here:\u003cbr\u003e\n\u003ca href=\"http://paulirish.com/2008/the-two-css-selector-bugs-in-ie6/\"\u003ehttp://paulirish.com/2008/the-two-css-selector-bugs-in-ie6/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eif you write\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-css\" data-lang=\"css\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#tooltip.\u003cspan style=\"color:#a6e22e\"\u003ered\u003c/span\u003e { \u003cspan style=\"color:#66d9ef\"\u003ebackground\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003ewhite\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ecolor\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003ered\u003c/span\u003e; }  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#tooltip.\u003cspan style=\"color:#a6e22e\"\u003eyellow\u003c/span\u003e { \u003cspan style=\"color:#66d9ef\"\u003ebackground\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003eblack\u003c/span\u003e; \u003cspan style=\"color:#66d9ef\"\u003ecolor\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003ered\u003c/span\u003e; }  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ethe second rule will be ignored\u003c/p\u003e","title":"The weirdest IE6 CSS bug – The multiple class bug"},{"content":"Quoting from http://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/2008_03_01_archive.html\n“If you create your own procs, prefix those procs to something that you won’t confuse with any other library’s procs, such as ‘cust’ for custom. Of cource, IncludeCustoms is set to true and CustomProcedureStartsWith should be set to ‘cust_{0}_’ so that a table name of Profile should have a custom proc of cust_Profile_SelectAll.”\nif you set CustomProcedureStartsWith to just ‘cust_’ as we have done in the past, a method is created for each stored procedure for each table, whereas using ‘cust_{0}_’ only creates one method for each stored procedure – that method is linked to the table its name is based on. Far more sensible.\n","permalink":"http://localhost:1313/posts/naming-conventions-for-custom-stored-procedures-to-be-used-in-nettiers/","summary":"\u003cp\u003eQuoting from \u003ca href=\"http://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/2008\"\u003ehttp://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/2008\u003c/a\u003e_03_01_archive.html\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“If you create your own procs, prefix those procs to something that you won’t confuse with any other library’s procs, such as ‘cust’ for custom. Of cource, IncludeCustoms is set to true and CustomProcedureStartsWith should be set to ‘cust_{0}_’ so that a table name of Profile should have a custom proc of cust_Profile_SelectAll.”\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eif you set CustomProcedureStartsWith to just ‘cust_’ as we have done in the past, a method is created for each stored procedure for each table, whereas using ‘cust_{0}_’ only creates one method for each stored procedure – that method is linked to the table its name is based on. Far more sensible.\u003c/p\u003e","title":"naming conventions for custom stored procedures to be used in netTiers"},{"content":"If your website produces this error, Rick Strahl has the answer:\nhttp://www.west-wind.com/weblog/posts/2011/Apr/04/Error-on-64-Bit-Install-of-IIS-LoadLibraryEx-failed-on-aspnetfilterdll\n","permalink":"http://localhost:1313/posts/calling-loadlibraryex-on-isapi-filter-cwindowsmicrosoft.netframeworkv4.0.30319spnet_filter.dll-failed/","summary":"\u003cp\u003eIf your website produces this error, Rick Strahl has the answer:\u003cbr\u003e\n\u003ca href=\"http://www.west-wind.com/weblog/posts/2011/Apr/04/Error-on-64-Bit-Install-of-IIS-LoadLibraryEx-failed-on-aspnetfilterdll\"\u003ehttp://www.west-wind.com/weblog/posts/2011/Apr/04/Error-on-64-Bit-Install-of-IIS-LoadLibraryEx-failed-on-aspnetfilterdll\u003c/a\u003e\u003c/p\u003e","title":"Calling LoadLibraryEx on ISAPI filter “C:WindowsMicrosoft.NETFrameworkv4.0.30319\u0007spnet_filter.dll” failed"},{"content":"some web applications need access to the “temporary asp.net files” folder. The IIS_IUSR role already has read/write access to it but sometimes (i.e. the ePortfolio system) it needs to create a folder and can’t do that, even when the AppPoolIdentity account is a member of the IIS_IUSR role. In that case I just created the folder and it was fine…\nThere could be a further problem when the AppPoolIdentity is a domain account:\nhttp://www.yusufozturk.info/iis7/asp-net-write-access-error-on-iis7-5.html\n","permalink":"http://localhost:1313/posts/iis-permissions-and-the-iis_iusr-role/","summary":"\u003cp\u003esome web applications need access to the “temporary asp.net files” folder. The IIS_IUSR role already has read/write access to it but sometimes (i.e. the ePortfolio system) it needs to create a folder and can’t do that, even when the AppPoolIdentity account is a member of the IIS_IUSR role. In that case I just created the folder and it was fine…\u003c/p\u003e\n\u003cp\u003eThere could be a further problem when the AppPoolIdentity is a domain account:\u003cbr\u003e\n\u003ca href=\"http://www.yusufozturk.info/iis7/asp-net-write-access-error-on-iis7-5.html\"\u003ehttp://www.yusufozturk.info/iis7/asp-net-write-access-error-on-iis7-5.html\u003c/a\u003e\u003c/p\u003e","title":"IIS Permissions and the IIS_IUSR role"},{"content":"would never have figured this one out:\nhttp://stackoverflow.com/questions/3188618/enabling-net-tcp\n","permalink":"http://localhost:1313/posts/enabling-wcf-web-services-in-iis7/","summary":"\u003cp\u003ewould never have figured this one out:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://stackoverflow.com/questions/3188618/enabling-net-tcp\" title=\"http://stackoverflow.com/questions/3188618/enabling-net-tcp\"\u003ehttp://stackoverflow.com/questions/3188618/enabling-net-tcp\u003c/a\u003e\u003c/p\u003e","title":"Enabling WCF web services in IIS7"},{"content":"Use this Visual Studio add in\nhttp://visualstudiogallery.msdn.microsoft.com/36a6eb45-a7b1-47c3-9e85-09f0aef6e879/\n","permalink":"http://localhost:1313/posts/referencing-assemblies-in-the-gac-in-visual-studio/","summary":"\u003cp\u003eUse this Visual Studio add in\u003cbr\u003e\n\u003ca href=\"http://visualstudiogallery.msdn.microsoft.com/36a6eb45-a7b1-47c3-9e85-09f0aef6e879/\"\u003ehttp://visualstudiogallery.msdn.microsoft.com/36a6eb45-a7b1-47c3-9e85-09f0aef6e879/\u003c/a\u003e\u003c/p\u003e","title":"Referencing assemblies in the GAC in Visual Studio"},{"content":"Entity tracking is clever and manages to keep a cache of recently used entities (and lists of entities) and, if it doesn’t see a change to an entity, it will return the cached version without going to the database – that’s what caching is after all. The problem is that ALL changes to the database MUST be made by the same project using .netTiers methods. If you’re developing an application and change data directly in the database then .netTiers won’t spot that. Pretty obvious really but do remember whether you have\nenableEntityTracking=\u0026quot;true\u0026quot; or\nenableEntityTracking=\u0026quot;false\u0026quot;\nin the SqlNetTiersProvider bit of your web.config\n","permalink":"http://localhost:1313/posts/beware-of-entity-tracking/","summary":"\u003cp\u003eEntity tracking is clever and manages to keep a cache of recently used entities (and lists of entities) and, if it doesn’t see a change to an entity, it will return the cached version without going to the database – that’s what caching is after all. The problem is that ALL changes to the database MUST be made by the same project using .netTiers methods. If you’re developing an application and change data directly in the database then .netTiers won’t spot that. Pretty obvious really but do remember whether you have\u003cbr\u003e\n\u003ccode\u003eenableEntityTracking=\u0026quot;true\u0026quot;\u003c/code\u003e\nor\u003cbr\u003e\n\u003ccode\u003eenableEntityTracking=\u0026quot;false\u0026quot;\u003c/code\u003e\u003cbr\u003e\nin the SqlNetTiersProvider bit of your web.config\u003c/p\u003e","title":"Beware of entity tracking"},{"content":".netTiers can be configured to only use stored procedures, which is a great way to reduce the possibility of the database being attacked as the user account can be given access to only execute stored procedures and not have any direct access to the tables. To do this, just set useStoredProcedure=true in the netTiers \u0026lt;providers\u0026gt; section of the web.config\nIf you do this, some pages (methods) will still need SELECT access to tables. By default, netTiers creates entitygridviews that use paging and so use the get_paged method, which calls the myTable_GetPaged stored procedure. This stored procedure builds a couple of SQL strings (SELECT statements) that are executed, which means that the user account needs to have access to run SELECT statements. To give SELECT access to all tables in the database, you can add the user account to the db_datareader role.\n","permalink":"http://localhost:1313/posts/usestoredproceduretrue-but-still-runs-select-statements/","summary":"\u003cp\u003e.netTiers can be configured to only use stored procedures, which is a great way to reduce the possibility of the database being attacked as the user account can be given access to only execute stored procedures and not have any direct access to the tables. To do this, just set useStoredProcedure=true in the netTiers \u003ccode\u003e\u0026lt;providers\u0026gt;\u003c/code\u003e section of the web.config\u003c/p\u003e\n\u003cp\u003eIf you do this, some pages (methods) will still need SELECT access to tables. By default, netTiers creates entitygridviews that use paging and so use the \u003ccode\u003eget_paged\u003c/code\u003e method, which calls the \u003ccode\u003emyTable_GetPaged\u003c/code\u003e stored procedure. This stored procedure builds a couple of SQL strings (SELECT statements) that are executed, which means that the user account needs to have access to run SELECT statements. To give SELECT access to all tables in the database, you can add the user account to the \u003ccode\u003edb_datareader\u003c/code\u003e role.\u003c/p\u003e","title":"useStoredProcedure=true but still runs SELECT statements"},{"content":"if you’re using a \u0026lt;data:MultiFormView ID=\u0026quot;FormView1\u0026quot;\u0026gt; bound to a \u0026lt;data:MyTableDataSource\u0026gt; then it isn’t obvious how to get the ID of a record that you’ve just inserted e.g. you might want to redirect back to the same form but with the new ID in the querystring to further edit the form or related information.\nThis is all you need to do:\nprotected void FormView1_ItemInserted(Object sender, EventArgs e) { int Myid = BMyTableDataSource.EntityId.Myid; } ","permalink":"http://localhost:1313/posts/getting-the-id-of-a-newly-inserted-record/","summary":"\u003cp\u003eif you’re using a \u003ccode\u003e\u0026lt;data:MultiFormView ID=\u0026quot;FormView1\u0026quot;\u0026gt;\u003c/code\u003e bound to a \u003ccode\u003e\u0026lt;data:MyTableDataSource\u0026gt;\u003c/code\u003e then it isn’t obvious how to get the ID of a record that you’ve just inserted e.g. you might want to redirect back to the same form but with the new ID in the querystring to further edit the form or related information.\u003c/p\u003e\n\u003cp\u003eThis is all you need to do:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eprotected\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e FormView1_ItemInserted(Object sender, EventArgs e)  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e Myid = BMyTableDataSource.EntityId.Myid;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Getting the ID of a newly inserted record"},{"content":"SQL Server allows each field in the database to have a description, so this description seems like the most useful place to put friendly names for fields that will appear on a netTiers generated admin page.\nWhen netTiers first runs, a config file is generated as specified in 01 MappingFile\nThis XML file lists all of the tables and for each table it lists all of the fields e.g.\n\u0026lt;Column Id=\u0026#34;title\u0026#34; CSType=\u0026#34;System.String\u0026#34; PropertyName=\u0026#34;Title\u0026#34; FieldName=\u0026#34;_title\u0026#34; FriendlyName=\u0026#34;Title\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34; /\u0026gt; netTiers will automatically convert the database field name of \u0026ldquo;title\u0026rdquo; to a FriendlyName of \u0026ldquo;Title\u0026rdquo;\nIt’s quite clever too and will convert a field name of \u0026quot;title_or_salutation\u0026quot; to a FriendlyName of \u0026quot;Title Or Salutation\u0026quot;\nYou can just modify the FriendlyNames in the config file (e.g. change it to FriendlyName=\u0026ldquo;Title or salutation\u0026rdquo;), regenerate the project and those modified FriendlyNames will be used as labels for fields in the admin pages. That doesn’t work well when your database structure keeps changing as new fields won’t be added to the config file.\nSo, the solution is for netTiers to recreate the config file each time the project is regenerated but for the FriendlyNames to come from the description property in the database.\nThe following change to the netTiers script will do this:\nSchemaMappingNetTiersMapInstance.Internal.cst\nchange as described here http://community.codesmithtools.com/nettiers/f/34/p/9968/37042.aspx#37042\nLine 22 change\n\u0026lt;Table Id=\u0026#34;\u0026lt;%= table.Name %\u0026gt;\u0026#34; EntityName=\u0026#34;\u0026lt;%=GetClassName(table)%\u0026gt;\u0026#34; Owner=\u0026#34;\u0026lt;%=GetOwnerName(table)%\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(table) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(table) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= GetFriendlyName(table) %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34;\u0026gt; to\n\u0026lt;Table Id=\u0026#34;\u0026lt;%= table.Name %\u0026gt;\u0026#34; EntityName=\u0026#34;\u0026lt;%=GetClassName(table)%\u0026gt;\u0026#34; Owner=\u0026#34;\u0026lt;%=GetOwnerName(table)%\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(table) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(table) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= ((table.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\]==null)||(table.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString().Length==0))?GetFriendlyName(table):table.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString() %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34;\u0026gt; Line 25 change\n\u0026lt;Column Id=\u0026#34;\u0026lt;%= column.Name %\u0026gt;\u0026#34; CSType=\u0026#34;\u0026lt;%= GetCSType(column) %\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(column) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(column) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= GetFriendlyName(column) %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34; /\u0026gt; to\n\u0026lt;Column Id=\u0026#34;\u0026lt;%= column.Name %\u0026gt;\u0026#34; CSType=\u0026#34;\u0026lt;%= GetCSType(column) %\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(column) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(column) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= ((column.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\]==null)||(column.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString().Length==0))?GetFriendlyName(column):column.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString() %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34; /\u0026gt; Line 36 change\n\u0026lt;View Id=\u0026#34;\u0026lt;%=view.Name%\u0026gt;\u0026#34; EntityName=\u0026#34;\u0026lt;%=GetClassName(view)%\u0026gt;\u0026#34; Owner=\u0026#34;\u0026lt;%=GetOwnerName(view)%\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(view) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(view) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= GetFriendlyName(view) %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34;\u0026gt; to\n\u0026lt;View Id=\u0026#34;\u0026lt;%=view.Name%\u0026gt;\u0026#34; EntityName=\u0026#34;\u0026lt;%=GetClassName(view)%\u0026gt;\u0026#34; Owner=\u0026#34;\u0026lt;%=GetOwnerName(view)%\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(view) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(view) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= ((view.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\]==null)||(view.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString().Length==0))?GetFriendlyName(view):view.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString() %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34;\u0026gt; Line 40 change\n\u0026lt;Column Id=\u0026#34;\u0026lt;%= column.Name %\u0026gt;\u0026#34; CSType=\u0026#34;\u0026lt;%= GetCSType(column) %\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(column) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(column) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= GetFriendlyName(column) %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34; /\u0026gt; to\n\u0026lt;Column Id=\u0026#34;\u0026lt;%= column.Name %\u0026gt;\u0026#34; CSType=\u0026#34;\u0026lt;%= GetCSType(column) %\u0026gt;\u0026#34; PropertyName=\u0026#34;\u0026lt;%= GetPropertyName(column) %\u0026gt;\u0026#34; FieldName=\u0026#34;\u0026lt;%= GetFieldName(column) %\u0026gt;\u0026#34; FriendlyName=\u0026#34;\u0026lt;%= ((column.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\]==null)||(column.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString().Length==0))?GetFriendlyName(column):column.ExtendedProperties[\u0026#34;MS_Description\u0026#34;\\].Value.ToString() %\u0026gt;\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34; /\u0026gt; ","permalink":"http://localhost:1313/posts/using-the-description-property-of-sql-server-fields-as-the-friendly-name/","summary":"\u003cp\u003eSQL Server allows each field in the database to have a description, so this description seems like the most useful place to put friendly names for fields that will appear on a netTiers generated admin page.\u003c/p\u003e\n\u003cp\u003eWhen netTiers first runs, a config file is generated as specified in 01 MappingFile\u003cbr\u003e\nThis XML file lists all of the tables and for each table it lists all of the fields e.g.\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026lt;Column Id=\u0026#34;title\u0026#34; CSType=\u0026#34;System.String\u0026#34; PropertyName=\u0026#34;Title\u0026#34; FieldName=\u0026#34;_title\u0026#34; FriendlyName=\u0026#34;Title\u0026#34; IncludeInOutput=\u0026#34;true\u0026#34; /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003enetTiers will automatically convert the database field name of \u0026ldquo;title\u0026rdquo; to a FriendlyName of \u0026ldquo;Title\u0026rdquo;\u003cbr\u003e\nIt’s quite clever too and will convert a field name of \u003ccode\u003e\u0026quot;title_or_salutation\u0026quot;\u003c/code\u003e to a FriendlyName of \u003ccode\u003e\u0026quot;Title Or Salutation\u0026quot;\u003c/code\u003e\u003c/p\u003e","title":"Using the description property of SQL Server fields as the friendly name"},{"content":"The normal \u0026lt;asp:SqlDataSource/\u0026gt; can use stored procedures as the select method and even for insert/update/delete commands.\nnetTiers will create a strongly typed data source for each table. The inserts, updates and deletes are handled automatically but there are options for which records to select. Get_Paged is the default but you can also get by any foreign key. Sometimes this isn’t enough and you want a custom filter for your entities. To do this, write a stored procedure that returns all of the columns in the base table and no other columns. The SP can have joins to other tables, so you can use those for filtering. The SP can have whatever parameters you like. Because the SP returns all of the columns of the base table, netTiers recognises that it can be used to get a list of entities and so allows it as a SelectMethod e.g.\n\u0026lt;data:MyEntityDataSource ID=\u0026#34;dMyEntityDataSource\u0026#34; runat=\u0026#34;server\u0026#34; SelectMethod=\u0026#34;MyTable\\_GetByMyId\\_DoSomethingSpecial\u0026#34; EnablePaging=\u0026#34;False\u0026#34; EnableSorting=\u0026#34;True\u0026#34; EnableDeepLoad=\u0026#34;True\u0026#34; \\\u0026gt; \u0026lt;Parameters\u0026gt; \u0026lt;asp:QueryStringParameter Name=\u0026#34;MyId\u0026#34; QueryStringField=\u0026#34;MyId\u0026#34; Type=\u0026#34;String\u0026#34; /\u0026gt; \u0026lt;/Parameters\u0026gt; \u0026lt;/data:MyEntity\u0026gt; The down side to this is that the stored procedure can page the records (unless you write it that way). This means that you should disable paging in the DataSource and in any linked GridView (or other control). See previous post on the problems doing that with EntityGridViews – you have to tell it to not page in the code behind. Unless you’re having to page through a lot of records, it’s better to return them all anyway and then use the jQuery DataTables plugin to page the records on the client side.\n","permalink":"http://localhost:1313/posts/using-stored-procedures-in-entity-data-sources/","summary":"\u003cp\u003eThe normal \u003ccode\u003e\u0026lt;asp:SqlDataSource/\u0026gt;\u003c/code\u003e can use stored procedures as the select method and even for insert/update/delete commands.\u003c/p\u003e\n\u003cp\u003enetTiers will create a strongly typed data source for each table. The inserts, updates and deletes are handled automatically but there are options for which records to select. \u003ccode\u003eGet_Paged\u003c/code\u003e is the default but you can also get by any foreign key. Sometimes this isn’t enough and you want a custom filter for your entities. To do this, write a stored procedure that returns all of the columns in the base table and no other columns. The SP can have joins to other tables, so you can use those for filtering. The SP can have whatever parameters you like. Because the SP returns all of the columns of the base table, netTiers recognises that it can be used to get a list of entities and so allows it as a SelectMethod e.g.\u003c/p\u003e","title":"Using stored procedures in entity data sources"},{"content":"After creating a record, you might want to automatically create a related child record, which uses the ID of the record you have just created. In your datasource \u0026lt;data:XyzDataSource\u0026gt; you can put in OnInserted=\u0026quot;Xyz_Inserted\u0026quot;:\n\u0026lt;data:XyzDataSource ID=\u0026#34;XyzDataSource\u0026#34; runat=\u0026#34;server\u0026#34; SelectMethod=\u0026#34;GetById\u0026#34; OnInserted=\u0026#34;Xyz_Inserted\u0026#34;\u0026gt; protected void Xyz\\_Inserted(Object sender, ObjectDataSourceStatusEventArgs e) { if (e.Exception == null) { if (FormView1.CurrentMode == FormViewMode.Insert) { Xyz myXyz = (Xyz)e.ReturnValue; int ID = myXyz .Id; // now create the child entity, set the parent id and insert it } } } The problem with this is that netTiers by default uses transactions and Xyz_Inserted is called in the middle of the transaction. So, whilst an ID has been returned for the new record, it hasn’t been committed to the database, so you can’t create the child record yet. The way around this is for the datasource to not use transactions.\n\u0026lt;data:XyzDataSource ID=\u0026#34;XyzDataSource\u0026#34; runat=\u0026#34;server\u0026#34; EnableTransaction=\u0026#34;false\u0026#34; SelectMethod=\u0026#34;GetById\u0026#34; OnInserted=\u0026#34;Xyz_Inserted\u0026#34;\u0026gt; ","permalink":"http://localhost:1313/posts/transactions-and-creating-related-records-on-insert/","summary":"\u003cp\u003eAfter creating a record, you might want to automatically create a related child record, which uses the ID of the record you have just created. In your datasource \u003ccode\u003e\u0026lt;data:XyzDataSource\u0026gt;\u003c/code\u003e you can put in \u003ccode\u003eOnInserted=\u0026quot;Xyz_Inserted\u0026quot;\u003c/code\u003e:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026lt;data:XyzDataSource ID=\u0026#34;XyzDataSource\u0026#34; runat=\u0026#34;server\u0026#34; SelectMethod=\u0026#34;GetById\u0026#34; OnInserted=\u0026#34;Xyz_Inserted\u0026#34;\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-C#\" data-lang=\"C#\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eprotected\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003evoid\u003c/span\u003e Xyz\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e\\\u003c/span\u003e_Inserted(Object sender, ObjectDataSourceStatusEventArgs e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (e.Exception == \u003cspan style=\"color:#66d9ef\"\u003enull\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (FormView1.CurrentMode == FormViewMode.Insert)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      Xyz myXyz  = (Xyz)e.ReturnValue;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#66d9ef\"\u003eint\u003c/span\u003e ID = myXyz .Id;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#75715e\"\u003e// now create the child entity, set the parent id and insert it\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe problem with this is that netTiers by default uses transactions and \u003ccode\u003eXyz_Inserted\u003c/code\u003e is called in the middle of the transaction. So, whilst an ID has been returned for the new record, it hasn’t been committed to the database, so you can’t create the child record yet. The way around this is for the datasource to not use transactions.\u003c/p\u003e","title":"transactions and creating related records on insert"},{"content":"Problem:\nAfter using a netTiers powered website for a while, the database connections would start to time out and you’d get a Stack Trace like:\nat System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error) Solution:\nNetTiers was using an EntityTransactionModule which was incorrectly configured. It was opening database connections and not closing them (I think) and so SQL Server eventually stops allowing connections. IIS 7.5 needs the following code in the web.config to correctly configure the module.\n\u0026lt;system.webServer\u0026gt; \u0026lt;validation validateIntegratedModeConfiguration=\u0026#34;false\u0026#34;/\u0026gt; \u0026lt;modules\u0026gt; \u0026lt;remove name=\u0026#34;EntityTransactionModule\u0026#34;/\u0026gt; \u0026lt;add name=\u0026#34;EntityTransactionModule\u0026#34; type=\u0026#34;MyApp.Web.Data.EntityTransactionModule\u0026#34;/\u0026gt; \u0026lt;/modules\u0026gt; \u0026lt;/system.webServer\u0026gt; I didn’t actually work this out myself, it came from the last post here http://community.codesmithtools.com/nettiers/f/16/t/4334.aspx\n","permalink":"http://localhost:1313/posts/database-connections-timing-out-in-iis-7.5-caused-by-entitytransactionmodule/","summary":"\u003cp\u003e\u003cstrong\u003eProblem:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eAfter using a netTiers powered website for a while, the database connections would start to time out and you’d get a Stack Trace like:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eat System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)  \nat System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)  \nat System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eSolution:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eNetTiers was using an EntityTransactionModule which was incorrectly configured. It was opening database connections and not closing them (I think) and so SQL Server eventually stops allowing connections. IIS 7.5 needs the following code in the web.config to correctly configure the module.\u003c/p\u003e","title":"Database connections timing out in IIS 7.5 – caused by EntityTransactionModule"},{"content":"If you need your netTiers gridview (EntityGridView) to have a column that just displays a read only value from a lookup table then the data source will need to deepload but \u0026lt;asp:BoundField\u0026gt; won’t be able to access the lookup value. NetTiers’ own controls are only dropdowns, hyperlinks and radiobuttons, so to display the lookup value (rather than the ID), you need to add a template field\n\u0026lt;asp:TemplateField\u0026gt; \u0026lt;ItemTemplate\u0026gt; \u0026lt;%# Eval(\u0026#34;ApplicIdSource.Applic\u0026#34;)%\u0026gt; \u0026lt;/ItemTemplate\u0026gt; \u0026lt;/asp:TemplateField\u0026gt; as described here:\nhttp://community.codesmithtools.com/nettiers/f/16/p/7121/27053.aspx\nAn alternative to this is to use a data:HyperLinkField/ field, use CSS to stop it looking like a hyperlink and don’t let it navigate anywhere:\n\u0026lt;data:HyperLinkField ControlStyle-CssClass=\u0026#34;table-hyperlink-nofollow\u0026#34; HeaderText=\u0026#34;Body part\u0026#34; DataNavigateUrlFormatString=\u0026#34;#\u0026#34; DataNavigateUrlFields=\u0026#34;Bodypartid\u0026#34; DataContainer=\u0026#34;BodypartidSource\u0026#34; DataTextField=\u0026#34;Bodypartdescription\u0026#34; /\u0026gt; The first method is probably the better way.\n","permalink":"http://localhost:1313/posts/nettiers-entitygridview-deepload-display-readonly-lookup/","summary":"\u003cp\u003eIf you need your netTiers gridview (EntityGridView) to have a column that just displays a read only value from a lookup table then the data source will need to deepload but \u003ccode\u003e\u0026lt;asp:BoundField\u0026gt;\u003c/code\u003e won’t be able to access the lookup value. NetTiers’ own controls are only dropdowns, hyperlinks and radiobuttons, so to display the lookup value (rather than the ID), you need to add a template field\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e\u0026lt;asp:TemplateField\u0026gt;  \n  \u0026lt;ItemTemplate\u0026gt;  \n    \u0026lt;%# Eval(\u0026#34;ApplicIdSource.Applic\u0026#34;)%\u0026gt;  \n  \u0026lt;/ItemTemplate\u0026gt;  \n\u0026lt;/asp:TemplateField\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eas described here:\u003c/p\u003e","title":"NetTiers EntityGridView Deepload display readonly lookup"},{"content":"Don’t name a field ID, id or Id\nIf you ask NetTiers to generate an admin website, then it will show warnings when compiled but these will result in errors when you try to run the site.\nEven if you don’t want an admin website to start with, you may want one later, so just don’t name any fields ID\n","permalink":"http://localhost:1313/posts/id-fields/","summary":"\u003cp\u003eDon’t name a field ID, id or Id\u003c/p\u003e\n\u003cp\u003eIf you ask NetTiers to generate an admin website, then it will show warnings when compiled but these will result in errors when you try to run the site.\u003c/p\u003e\n\u003cp\u003eEven if you don’t want an admin website to start with, you may want one later, so just don’t name any fields ID\u003c/p\u003e","title":"ID fields"},{"content":"You may want your custom stored procedures to contain conditional statements such as IF. These can cause problems when NetTiers inspects the procedure to determine its outputs – it may normally return a table but an IF statement traps for an exception and conditionally returns before the select statement. You can force NetTiers to follow one route through the code e.g. the statement below will never return for NetTiers\nIF user_name() \u0026lt;\u0026gt; \u0026#39;NetTiersUserAccount\u0026#39; AND ThingToTest = ValueThatMakesItReturn RETURN Just make sure that the user account in the connection string used by NetTiers is not used by anything other than NetTiers i.e. not in you web.config\n","permalink":"http://localhost:1313/posts/if-statements-in-custom-stored-procedures/","summary":"\u003cp\u003eYou may want your custom stored procedures to contain conditional statements such as \u003ccode\u003eIF\u003c/code\u003e. These can cause problems when NetTiers inspects the procedure to determine its outputs – it may normally return a table but an \u003ccode\u003eIF\u003c/code\u003e statement traps for an exception and conditionally returns before the select statement. You can force NetTiers to follow one route through the code e.g. the statement below will never return for NetTiers\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eIF user_name() \u0026lt;\u0026gt; \u0026#39;NetTiersUserAccount\u0026#39; AND ThingToTest = ValueThatMakesItReturn RETURN\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eJust make sure that the user account in the connection string used by NetTiers is not used by anything other than NetTiers i.e. not in you web.config\u003c/p\u003e","title":"IF statements in custom stored procedures"},{"content":"If you get this error with NetTiers, it’s probably because you have a field named with a reserved word such as:\nTag\nID\nSortOrder\nRename the field\n","permalink":"http://localhost:1313/posts/system.reflection.ambiguousmatchexception-ambiguous-match-found./","summary":"\u003cp\u003eIf you get this error with NetTiers, it’s probably because you have a field named with a reserved word such as:\u003c/p\u003e\n\u003cp\u003eTag\u003cbr\u003e\nID\u003cbr\u003e\nSortOrder\u003c/p\u003e\n\u003cp\u003eRename the field\u003c/p\u003e","title":"System.Reflection.AmbiguousMatchException: Ambiguous match found."},{"content":"If you have NetTiers open and have generated code, then make changes to the database, you need to completely close and re-open CodeSmith / NetTiers for it to fully recognise the changes. Something or other gets cached and NetTiers doesn’t spot the database changes – this was a pain to track down.\n","permalink":"http://localhost:1313/posts/completely-close-and-re-open-nettiers-after-database-changes/","summary":"\u003cp\u003eIf you have NetTiers open and have generated code, then make changes to the database, you need to completely close and re-open CodeSmith / NetTiers for it to fully recognise the changes. Something or other gets cached and NetTiers doesn’t spot the database changes – this was a pain to track down.\u003c/p\u003e","title":"completely close and re-open NetTiers after database changes"},{"content":"Don’t call a field in the database “SortOrder”\nIt breaks nettiers in subtle ways that are hard to spot\n","permalink":"http://localhost:1313/posts/sortorder/","summary":"\u003cp\u003eDon’t call a field in the database “SortOrder”\u003cbr\u003e\nIt breaks nettiers in subtle ways that are hard to spot\u003c/p\u003e","title":"SortOrder"},{"content":"I’d set up the MedicineExaminers system to not allow nulls on any fields – they were supposed to contain empty strings if there was no data e.g. no email address.\nThe NetTiers generated site didn’t like this as it made the fields required. I’ve changed the fields to allow nulls and so now, if I have an empty text box, NetTiers sets the value to null in the database.\nLookup lists (e.g. speciality) will have values such as “not known”, so foreign keys will never need to be null.\n","permalink":"http://localhost:1313/posts/empty-fields/","summary":"\u003cp\u003eI’d set up the MedicineExaminers system to not allow nulls on any fields – they were supposed to contain empty strings if there was no data e.g. no email address.\u003c/p\u003e\n\u003cp\u003eThe NetTiers generated site didn’t like this as it made the fields required. I’ve changed the fields to allow nulls and so now, if I have an empty text box, NetTiers sets the value to null in the database.\u003c/p\u003e\n\u003cp\u003eLookup lists (e.g. speciality) will have values such as “not known”, so foreign keys will never need to be null.\u003c/p\u003e","title":"empty fields"}]